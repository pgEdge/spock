diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/preseed.out /Users/pgedge/pgedge/spock-ibrar/results/preseed.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/preseed.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/preseed.out	2025-12-04 16:02:52
@@ -13,83 +13,11 @@
 $f$;
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 /*
  * Tests to ensure that objects/data that exists pre-clone is successfully
  * cloned. The results are checked, after the clone, in preseed_check.sql.
  */
 \c :provider_dsn
-CREATE SEQUENCE some_local_seq;
-CREATE TABLE some_local_tbl(id serial primary key, key text unique not null, data text);
-INSERT INTO some_local_tbl(key, data) VALUES('key1', 'data1');
-INSERT INTO some_local_tbl(key, data) VALUES('key2', NULL);
-INSERT INTO some_local_tbl(key, data) VALUES('key3', 'data3');
-CREATE TABLE some_local_tbl1(id serial, key text unique not null, data text);
-INSERT INTO some_local_tbl1(key, data) VALUES('key1', 'data1');
-INSERT INTO some_local_tbl1(key, data) VALUES('key2', NULL);
-INSERT INTO some_local_tbl1(key, data) VALUES('key3', 'data3');
-CREATE TABLE some_local_tbl2(id serial, key text, data text);
-INSERT INTO some_local_tbl2(key, data) VALUES('key1', 'data1');
-INSERT INTO some_local_tbl2(key, data) VALUES('key2', NULL);
-INSERT INTO some_local_tbl2(key, data) VALUES('key3', 'data3');
-CREATE TABLE some_local_tbl3(id integer, key text, data text);
-INSERT INTO some_local_tbl3(key, data) VALUES('key1', 'data1');
-INSERT INTO some_local_tbl3(key, data) VALUES('key2', NULL);
-INSERT INTO some_local_tbl3(key, data) VALUES('key3', 'data3');
-/*
- * Make sure that the spock_regress_variables function exists both on
- * provider and subscriber since the original connection might have been
- * to completely different database.
- */
-CREATE OR REPLACE FUNCTION public.spock_regress_variables(
-    OUT orig_provider_dsn text,
-    OUT provider_dsn text,
-    OUT provider1_dsn text,
-    OUT subscriber_dsn text
-    ) RETURNS record LANGUAGE SQL AS $f$
-SELECT
-    current_setting('spock.orig_provider_dsn'),
-    current_setting('spock.provider_dsn'),
-    current_setting('spock.provider1_dsn'),
-    current_setting('spock.subscriber_dsn')
-$f$;
-CREATE DATABASE regression1;
-CREATE DATABASE sourcedb;
-\c :orig_provider_dsn
-CREATE OR REPLACE FUNCTION public.spock_regress_variables(
-    OUT orig_provider_dsn text,
-    OUT provider_dsn text,
-    OUT provider1_dsn text,
-    OUT subscriber_dsn text
-    ) RETURNS record LANGUAGE SQL AS $f$
-SELECT
-    current_setting('spock.orig_provider_dsn'),
-    current_setting('spock.provider_dsn'),
-    current_setting('spock.provider1_dsn'),
-    current_setting('spock.subscriber_dsn')
-$f$;
-\c :provider1_dsn
-CREATE OR REPLACE FUNCTION public.spock_regress_variables(
-    OUT orig_provider_dsn text,
-    OUT provider_dsn text,
-    OUT provider1_dsn text,
-    OUT subscriber_dsn text
-    ) RETURNS record LANGUAGE SQL AS $f$
-SELECT
-    current_setting('spock.orig_provider_dsn'),
-    current_setting('spock.provider_dsn'),
-    current_setting('spock.provider1_dsn'),
-    current_setting('spock.subscriber_dsn')
-$f$;
-\c :subscriber_dsn
-CREATE OR REPLACE FUNCTION public.spock_regress_variables(
-    OUT orig_provider_dsn text,
-    OUT provider_dsn text,
-    OUT provider1_dsn text,
-    OUT subscriber_dsn text
-    ) RETURNS record LANGUAGE SQL AS $f$
-SELECT
-    current_setting('spock.orig_provider_dsn'),
-    current_setting('spock.provider_dsn'),
-    current_setting('spock.provider1_dsn'),
-    current_setting('spock.subscriber_dsn')
-$f$;
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/init_fail.out /Users/pgedge/pgedge/spock-ibrar/results/init_fail.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/init_fail.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/init_fail.out	2025-12-04 16:02:53
@@ -1,95 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SET client_min_messages = 'warning';
-DROP ROLE IF EXISTS nonreplica;
-CREATE USER nonreplica;
-CREATE EXTENSION IF NOT EXISTS spock;
-GRANT ALL ON SCHEMA spock TO nonreplica;
-GRANT ALL ON ALL TABLES IN SCHEMA spock TO nonreplica;
-\c :subscriber_dsn
-SET client_min_messages = 'warning';
-\set VERBOSITY terse
-DO $$
-BEGIN
-  CREATE EXTENSION IF NOT EXISTS spock VERSION '6.0.0-devel';
-END;
-$$;
-ALTER EXTENSION spock UPDATE;
--- fail (local node not existing)
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription',
-    provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=nonreplica',
-	forward_origins := '{}');
-ERROR:  local spock node not found
--- succeed
-SELECT * FROM spock.node_create(node_name := 'test_subscriber', dsn := (SELECT subscriber_dsn FROM spock_regress_variables()) || ' user=nonreplica');
- node_create 
--------------
-       52665
-(1 row)
-
--- fail (can't connect to remote)
-DO $$
-BEGIN
-    SELECT * FROM spock.sub_create(
-        subscription_name := 'test_subscription',
-        provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=nonexisting',
-        forward_origins := '{}');
-EXCEPTION
-    WHEN OTHERS THEN
-        RAISE EXCEPTION '%:%', split_part(SQLERRM, ':', 1), (regexp_matches(SQLERRM, '^.*( FATAL:.*role.*)$'))[1];
-END;
-$$;
-ERROR:  could not connect to the postgresql server: FATAL:  role "nonexisting" does not exist
-
--- fail (remote node not existing)
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription',
-    provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=nonreplica',
-	forward_origins := '{}');
-ERROR:  could not fetch remote node info: ERROR:  local spock node not found
-
-
-\c :provider_dsn
--- succeed
-SELECT * FROM spock.node_create(node_name := 'test_provider', dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=nonreplica');
- node_create 
--------------
-       45328
-(1 row)
-
-\c :subscriber_dsn
-\set VERBOSITY terse
--- fail (can't connect with replication connection to remote)
-DO $$
-BEGIN
-    SELECT * FROM spock.sub_create(
-        subscription_name := 'test_subscription',
-        provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=nonreplica',
-            forward_origins := '{}');
-EXCEPTION
-    WHEN OTHERS THEN
-        RAISE EXCEPTION '%', split_part(SQLERRM, ':', 1);
-END;
-$$;
-ERROR:  could not connect to the postgresql server in replication mode
--- cleanup
-SELECT * FROM spock.node_drop('test_subscriber');
- node_drop 
------------
- t
-(1 row)
-
-DROP EXTENSION spock;
-\c :provider_dsn
-SELECT * FROM spock.node_drop('test_provider');
- node_drop 
------------
- t
-(1 row)
-
-SET client_min_messages = 'warning';
-DROP OWNED BY nonreplica;
-DROP ROLE IF EXISTS nonreplica;
-DROP EXTENSION spock;
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/init_1.out /Users/pgedge/pgedge/spock-ibrar/results/init.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/init_1.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/init.out	2025-12-04 16:02:53
@@ -2,181 +2,7 @@
 -- but it's blocked by bug 37906
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SET client_min_messages = 'warning';
-DROP USER IF EXISTS nonsuper;
-DROP USER IF EXISTS super;
-CREATE USER nonsuper WITH replication;
-CREATE USER super SUPERUSER;
-\c :subscriber_dsn
-SET client_min_messages = 'warning';
-DROP USER IF EXISTS nonsuper;
-DROP USER IF EXISTS super;
-CREATE USER nonsuper WITH replication;
-CREATE USER super SUPERUSER;
--- Can't because of bug 37906
---GRANT ALL ON DATABASE regress TO nonsuper;
---GRANT ALL ON DATABASE regress TO nonsuper;
-\c :provider_dsn
-GRANT ALL ON SCHEMA public TO nonsuper;
-DO $$
-BEGIN
-	IF (SELECT setting::integer/100 FROM pg_settings WHERE name = 'server_version_num') >= 1000 THEN
-		CREATE OR REPLACE FUNCTION public.pg_current_xlog_location() RETURNS pg_lsn
-		LANGUAGE SQL AS 'SELECT pg_current_wal_lsn()';
-		ALTER FUNCTION public.pg_current_xlog_location() OWNER TO super;
-	END IF;
-END; $$;
-\c :subscriber_dsn
-GRANT ALL ON SCHEMA public TO nonsuper;
-SELECT E'\'' || current_database() || E'\'' AS subdb;
-   subdb    
-------------
- 'postgres'
-(1 row)
-
-\gset
-\c :provider_dsn
-SET client_min_messages = 'warning';
-CREATE EXTENSION IF NOT EXISTS spock;
-\dx spock
-                          List of installed extensions
- Name  |   Version   | Default version | Schema |          Description           
--------+-------------+-----------------+--------+--------------------------------
- spock | 6.0.0-devel | 6.0.0-devel     | spock  | PostgreSQL Logical Replication
-(1 row)
-
-SELECT * FROM spock.node_create(node_name := 'test_provider', dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super');
- node_create 
--------------
-       45328
-(1 row)
-
-\c :subscriber_dsn
-SET client_min_messages = 'warning';
-CREATE EXTENSION IF NOT EXISTS spock;
-SELECT * FROM spock.node_create(node_name := 'test_subscriber', dsn := (SELECT subscriber_dsn FROM spock_regress_variables()) || ' user=super');
- node_create 
--------------
-       52665
-(1 row)
-
-BEGIN;
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription',
-    provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super',
-	synchronize_structure := true,
-	synchronize_data := true,
-	forward_origins := '{}');
- sub_create 
-------------
- 3848008564
-(1 row)
-
-/*
- * Remove the function we added in preseed because otherwise the restore of
- * schema will fail. We do this in same transaction as sub_create()
- * because the subscription process will only start on commit.
- */
-DROP FUNCTION IF EXISTS public.spock_regress_variables();
-COMMIT;
-BEGIN;
-SET LOCAL statement_timeout = '30s';
-SELECT spock.sub_wait_for_sync('test_subscription');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-SELECT sync_kind, sync_subid, sync_nspname, sync_relname, sync_status IN ('y', 'r') FROM spock.local_sync_status ORDER BY 2,3,4;
- sync_kind | sync_subid | sync_nspname | sync_relname | ?column? 
------------+------------+--------------+--------------+----------
- f         | 3848008564 |              |              | t
-(1 row)
-
--- Make sure we see the slot and active connection
-\c :provider_dsn
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
-(1 row)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     1
-(1 row)
-
-CREATE OR REPLACE FUNCTION fetch_last_xid(action char DEFAULT 'U')
-RETURNS xid
-LANGUAGE plpgsql
-AS $$
-DECLARE
-    remote_xid xid;
-    i INTEGER;
-    slot TEXT;
-BEGIN
-    -- Wait up to 10 seconds (100 x 0.1s) for an inactive slot
-    FOR i IN 1..100 LOOP
-        IF EXISTS (SELECT 1 FROM pg_replication_slots WHERE active = false) THEN
-            EXIT;
-        END IF;
-        PERFORM pg_sleep(0.1);
-    END LOOP;
-
-    -- Get slot name
-    SELECT slot_name INTO slot FROM pg_replication_slots LIMIT 1;
-
-    -- Fetch the remote xid of last UPDATE ('U') action
-    SELECT xid
-    INTO remote_xid
-    FROM pg_logical_slot_peek_changes(
-            slot,
-            NULL,
-            10,
-            'min_proto_version', '3',
-            'max_proto_version', '4',
-            'startup_params_format', '1',
-            'proto_format', 'json',
-            'spock.replication_set_names', 'default,ddl_sql'
-        ) AS changes(lsn, xid, data)
-    WHERE data IS NOT NULL
-      AND data <> ''
-      AND data::json->>'action' = action
-    LIMIT 1;
-
-    RETURN remote_xid;
-END;
-$$;
-\c :subscriber_dsn
-CREATE OR REPLACE FUNCTION skiplsn_and_enable_sub(
-    sub_name text,
-    p_remote_xid bigint
-)
-RETURNS void
-LANGUAGE plpgsql
-AS $$
-DECLARE
-    skiplsn text;
-BEGIN
-    -- Extract skip_lsn from exception_log
-    SELECT quote_literal((regexp_match(error_message, 'skip_lsn = ([0-9A-F/]+)'))[1])
-    INTO skiplsn
-    FROM spock.exception_log
-    WHERE remote_xid = p_remote_xid
-      AND operation = 'SUB_DISABLE'
-    LIMIT 1;
-
-    IF skiplsn IS NULL THEN
-        RAISE EXCEPTION 'skip_lsn not found for remote_xid = %', p_remote_xid;
-    END IF;
-
-    -- Alter subscription to skip the problematic LSN
-    EXECUTE format('SELECT spock.sub_alter_skiplsn(%L, %s)', sub_name, skiplsn);
-
-    -- Re-enable the subscription
-    EXECUTE format('SELECT spock.sub_enable(%L, true)', sub_name);
-END;
-$$;
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/preseed_check.out /Users/pgedge/pgedge/spock-ibrar/results/preseed_check.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/preseed_check.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/preseed_check.out	2025-12-04 16:02:53
@@ -1,135 +1,7 @@
 -- Verify data from preseed.sql has correctly been cloned
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | t          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl ORDER BY id;
- id | key  | data  
-----+------+-------
-  1 | key1 | data1
-  2 | key2 | 
-  3 | key3 | data3
-(3 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl1'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | t          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl1 ORDER BY id;
- id | key  | data  
-----+------+-------
-  1 | key1 | data1
-  2 | key2 | 
-  3 | key3 | data3
-(3 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl2'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | f          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl2 ORDER BY id;
- id | key  | data  
-----+------+-------
-  1 | key1 | data1
-  2 | key2 | 
-  3 | key3 | data3
-(3 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl3'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | f          | f
- key     | f          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl3 ORDER BY id;
- id | key  | data  
-----+------+-------
-    | key1 | data1
-    | key2 | 
-    | key3 | data3
-(3 rows)
-
-\c :subscriber_dsn
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | t          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl ORDER BY id;
- id | key | data 
-----+-----+------
-(0 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl1'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | t          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl1 ORDER BY id;
- id | key | data 
-----+-----+------
-(0 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl2'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | t          | f
- key     | f          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl2 ORDER BY id;
- id | key | data 
-----+-----+------
-(0 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'some_local_tbl3'::regclass and attnum > 0 order by attnum;
- attname | attnotnull | attisdropped 
----------+------------+--------------
- id      | f          | f
- key     | f          | f
- data    | f          | f
-(3 rows)
-
-SELECT * FROM some_local_tbl3 ORDER BY id;
- id | key | data 
-----+-----+------
-(0 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP SEQUENCE public.some_local_seq;
-	DROP TABLE public.some_local_tbl;
-	DROP TABLE public.some_local_tbl1;
-	DROP TABLE public.some_local_tbl2;
-	DROP TABLE public.some_local_tbl3;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/basic.out /Users/pgedge/pgedge/spock-ibrar/results/basic.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/basic.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/basic.out	2025-12-04 16:02:53
@@ -1,213 +1,7 @@
 -- basic builtin datatypes
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.basic_dml (
-		id serial primary key,
-		other integer,
-		data text,
-		something interval
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-ALTER TABLE public.basic_dml ADD COLUMN subonly integer;
-ALTER TABLE public.basic_dml ADD COLUMN subonly_def integer DEFAULT 99;
-\c :provider_dsn
--- check basic insert replication
-INSERT INTO basic_dml(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something, subonly, subonly_def FROM basic_dml ORDER BY id;
- id | other | data |    something     | subonly | subonly_def 
-----+-------+------+------------------+---------+-------------
-  1 |     5 | foo  | @ 1 min          |         |          99
-  2 |     4 | bar  | @ 84 days        |         |          99
-  3 |     3 | baz  | @ 2 years 1 hour |         |          99
-  4 |     2 | qux  | @ 8 mons 2 days  |         |          99
-  5 |     1 |      |                  |         |          99
-(5 rows)
-
--- update one row
-\c :provider_dsn
-UPDATE basic_dml SET other = '4', data = NULL, something = '3 days'::interval WHERE id = 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days
-  5 |     1 |      | 
-(5 rows)
-
--- update multiple rows
-\c :provider_dsn
-UPDATE basic_dml SET other = id, data = data || id::text;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     1 | foo1 | @ 1 min
-  2 |     2 | bar2 | @ 84 days
-  3 |     3 | baz3 | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days
-  5 |     5 |      | 
-(5 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET other = id, something = something - '10 seconds'::interval WHERE id < 3;
-UPDATE basic_dml SET other = id, something = something + '10 seconds'::interval WHERE id > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something, subonly, subonly_def FROM basic_dml ORDER BY id;
- id | other | data |     something      | subonly | subonly_def 
-----+-------+------+--------------------+---------+-------------
-  1 |     1 | foo1 | @ 50 secs          |         |          99
-  2 |     2 | bar2 | @ 84 days -10 secs |         |          99
-  3 |     3 | baz3 | @ 2 years 1 hour   |         |          99
-  4 |     4 |      | @ 3 days 10 secs   |         |          99
-  5 |     5 |      |                    |         |          99
-(5 rows)
-
--- delete one row
-\c :provider_dsn
-DELETE FROM basic_dml WHERE id = 2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     1 | foo1 | @ 50 secs
-  3 |     3 | baz3 | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-(4 rows)
-
--- delete multiple rows
-\c :provider_dsn
-DELETE FROM basic_dml WHERE id < 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-(2 rows)
-
--- truncate
-\c :provider_dsn
-TRUNCATE basic_dml;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data | something 
-----+-------+------+-----------
-(0 rows)
-
--- copy
-\c :provider_dsn
-\COPY basic_dml FROM STDIN WITH CSV
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
-  id  | other | data | something 
-------+-------+------+-----------
- 9000 |     1 | aaa  | @ 1 hour
- 9001 |     2 | bbb  | @ 2 years
- 9002 |     3 | ccc  | @ 3 mins
- 9003 |     4 | ddd  | @ 4 days
-(4 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.basic_dml CASCADE;
-$$);
-NOTICE:  drop cascades to table basic_dml membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT '''' || provider_dsn || ' password=abc' || '''' AS fakecreds
-FROM spock_regress_variables()
-\gset
--- Check password will not be exposed
-SELECT spock.sub_create(
-  subscription_name := 'subscription1',
-  provider_dsn := :fakecreds);
-ERROR:  dsn "dbname=regression passwordXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
-CREATE FUNCTION call_fn(creds text) RETURNS void AS $$
-  SELECT spock.sub_create(
-    subscription_name := 'subscription1',
-    provider_dsn := creds);
-$$ LANGUAGE SQL IMMUTABLE STRICT PARALLEL SAFE;
-SELECT call_fn(:fakecreds);
-ERROR:  dsn "dbname=regression passwordXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/conflict_secondary_unique.out /Users/pgedge/pgedge/spock-ibrar/results/conflict_secondary_unique.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/conflict_secondary_unique.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/conflict_secondary_unique.out	2025-12-04 16:02:53
@@ -1,98 +1,7 @@
 --PRIMARY KEY
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
--- Test conflicts where a secondary unique constraint with a predicate exits,
--- ensuring we don't generate false conflicts.
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.secondary_unique_pred (
-    a integer PRIMARY KEY,
-    b integer NOT NULL,
-    check_unique boolean NOT NULL
-);
-
-CREATE UNIQUE INDEX ON public.secondary_unique_pred (b) WHERE (check_unique);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'secondary_unique_pred');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO secondary_unique_pred (a, b, check_unique) VALUES (1, 1, false);
-INSERT INTO secondary_unique_pred (a, b, check_unique) VALUES (2, 1, false);
-INSERT INTO secondary_unique_pred (a, b, check_unique) VALUES (3, 2, true);
--- must fail
-INSERT INTO secondary_unique_pred (a, b, check_unique) VALUES (5, 2, true);
-ERROR:  duplicate key value violates unique constraint "secondary_unique_pred_b_idx"
-DETAIL:  Key (b)=(2) already exists.
-SELECT * FROM secondary_unique_pred ORDER BY a;
- a | b | check_unique 
----+---+--------------
- 1 | 1 | f
- 2 | 1 | f
- 3 | 2 | t
-(3 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM secondary_unique_pred ORDER BY a;
- a | b | check_unique 
----+---+--------------
- 1 | 1 | f
- 2 | 1 | f
- 3 | 2 | t
-(3 rows)
-
-\c :provider_dsn
--- This line doesn't conflict on the provider. On the subscriber
--- we must not detect a conflict on (b), since the existing local
--- row matches (check_unique) but the new remote row doesn't. So
--- this must get applied.
-INSERT INTO secondary_unique_pred (a, b, check_unique) VALUES (4, 2, false);
-SELECT * FROM secondary_unique_pred ORDER BY a;
- a | b | check_unique 
----+---+--------------
- 1 | 1 | f
- 2 | 1 | f
- 3 | 2 | t
- 4 | 2 | f
-(4 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM secondary_unique_pred ORDER BY a;
- a | b | check_unique 
----+---+--------------
- 1 | 1 | f
- 2 | 1 | f
- 3 | 2 | t
- 4 | 2 | f
-(4 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.secondary_unique_pred CASCADE;
-$$);
-NOTICE:  drop cascades to table secondary_unique_pred membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/toasted.out /Users/pgedge/pgedge/spock-ibrar/results/toasted.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/toasted.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/toasted.out	2025-12-04 16:02:53
@@ -1,88 +1,7 @@
 -- test toasted data
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-BEGIN;
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.toasted (
-		id serial primary key,
-		other text,
-		data text NOT NULL
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'toasted');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.replicate_ddl($$
-	ALTER TABLE public.toasted ALTER COLUMN data SET STORAGE EXTERNAL;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-COMMIT;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- check replication of toast values
-INSERT INTO toasted(other, data) VALUES('foo', repeat('1234567890', 300));
--- check that unchanged toast values work correctly
-UPDATE toasted SET other = 'foo2';
--- check that changed toast values are replicated
-UPDATE toasted SET other = 'foo3', data = '-'||data;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM toasted ORDER BY id;
- id | other |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-----+-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-  1 | foo3  | -123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
-(1 row)
-
-\c :provider_dsn
-\copy toasted from stdin with csv
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM toasted ORDER BY id;
-  id  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          other                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-    1 | foo3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | -123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
- 9000 | aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa | bar
- 9001 | bbb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ccc
- 9002 | ddd                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | eee
- 9003 | bar                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
- 9004 | fff                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | hhh
-(6 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.toasted CASCADE;
-$$);
-NOTICE:  drop cascades to table toasted membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/replication_set.out /Users/pgedge/pgedge/spock-ibrar/results/replication_set.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/replication_set.out	2025-11-20 18:20:49
+++ /Users/pgedge/pgedge/spock-ibrar/results/replication_set.out	2025-12-04 16:02:53
@@ -1,674 +1,7 @@
 /* First test whether a table's replication set can be properly manipulated */
 SELECT * FROM spock_regress_variables()
 \gset
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE SCHEMA normalschema;
-CREATE SCHEMA "strange.schema-IS";
-CREATE TABLE public.test_publicschema(id serial primary key, data text);
-CREATE TABLE normalschema.test_normalschema(id serial primary key);
-CREATE TABLE "strange.schema-IS".test_strangeschema(id serial primary key);
-CREATE TABLE public.test_nopkey(id int);
-CREATE UNLOGGED TABLE public.test_unlogged(id int primary key);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
- WHERE relname IN ('test_publicschema', 'test_normalschema', 'test_strangeschema', 'test_nopkey') ORDER BY 1,2,3;
-      nspname      |      relname       | set_name 
--------------------+--------------------+----------
- normalschema      | test_normalschema  | 
- public            | test_nopkey        | 
- public            | test_publicschema  | 
- strange.schema-IS | test_strangeschema | 
-(4 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- show initial replication sets
-SELECT nspname, relname, set_name FROM spock.tables
- WHERE relname IN ('test_publicschema', 'test_normalschema', 'test_strangeschema', 'test_nopkey') ORDER BY 1,2,3;
-      nspname      |      relname       | set_name 
--------------------+--------------------+----------
- normalschema      | test_normalschema  | 
- public            | test_nopkey        | 
- public            | test_publicschema  | 
- strange.schema-IS | test_strangeschema | 
-(4 rows)
-
--- not existing replication set
-SELECT * FROM spock.repset_add_table('nonexisting', 'test_publicschema');
-ERROR:  replication set nonexisting not found
--- create some replication sets
-SELECT * FROM spock.repset_create('repset_replicate_all');
- repset_create 
----------------
-    2353314786
-(1 row)
-
-SELECT * FROM spock.repset_create('repset_replicate_instrunc', replicate_update := false, replicate_delete := false);
- repset_create 
----------------
-    1585236067
-(1 row)
-
-SELECT * FROM spock.repset_create('repset_replicate_insupd', replicate_delete := false, replicate_truncate := false);
- repset_create 
----------------
-     384626605
-(1 row)
-
--- add tables
-SELECT * FROM spock.repset_add_table('repset_replicate_all', 'test_publicschema');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('repset_replicate_instrunc', 'normalschema.test_normalschema');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('repset_replicate_insupd', 'normalschema.test_normalschema');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('repset_replicate_insupd', '"strange.schema-IS".test_strangeschema');
- repset_add_table 
-------------------
- t
-(1 row)
-
--- should fail
-SELECT * FROM spock.repset_add_table('repset_replicate_all', 'test_unlogged');
-ERROR:  UNLOGGED and TEMP tables cannot be replicated
-SELECT * FROM spock.repset_add_table('repset_replicate_all', 'test_nopkey');
-ERROR:  table test_nopkey cannot be added to replication set repset_replicate_all
-DETAIL:  table does not have PRIMARY KEY and given replication set is configured to replicate UPDATEs and/or DELETEs
-HINT:  Add a PRIMARY KEY to the table
--- success
-SELECT * FROM spock.repset_add_table('repset_replicate_instrunc', 'test_nopkey');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_alter('repset_replicate_insupd', replicate_truncate := true);
- repset_alter 
---------------
-    384626605
-(1 row)
-
--- fail again
-SELECT * FROM spock.repset_add_table('repset_replicate_insupd', 'test_nopkey');
-ERROR:  table test_nopkey cannot be added to replication set repset_replicate_insupd
-DETAIL:  table does not have PRIMARY KEY and given replication set is configured to replicate UPDATEs and/or DELETEs
-HINT:  Add a PRIMARY KEY to the table
-SELECT * FROM spock.repset_add_all_tables('default', '{public}');
-ERROR:  table test_nopkey cannot be added to replication set default
-DETAIL:  table does not have PRIMARY KEY and given replication set is configured to replicate UPDATEs and/or DELETEs
-HINT:  Add a PRIMARY KEY to the table
-SELECT * FROM spock.repset_alter('repset_replicate_instrunc', replicate_update := true);
-ERROR:  replication set repset_replicate_instrunc cannot be altered to replicate UPDATEs or DELETEs because it contains tables without PRIMARY KEY
-SELECT * FROM spock.repset_alter('repset_replicate_instrunc', replicate_delete := true);
-ERROR:  replication set repset_replicate_instrunc cannot be altered to replicate UPDATEs or DELETEs because it contains tables without PRIMARY KEY
--- Adding already-added fails
-\set VERBOSITY terse
-SELECT * FROM spock.repset_add_table('repset_replicate_all', 'public.test_publicschema');
-ERROR:  duplicate key value violates unique constraint "replication_set_table_pkey"
-\set VERBOSITY default
--- check the replication sets
-SELECT nspname, relname, set_name FROM spock.tables
- WHERE relname IN ('test_publicschema', 'test_normalschema', 'test_strangeschema', 'test_nopkey') ORDER BY 1,2,3;
-      nspname      |      relname       |         set_name          
--------------------+--------------------+---------------------------
- normalschema      | test_normalschema  | repset_replicate_instrunc
- normalschema      | test_normalschema  | repset_replicate_insupd
- public            | test_nopkey        | repset_replicate_instrunc
- public            | test_publicschema  | repset_replicate_all
- strange.schema-IS | test_strangeschema | repset_replicate_insupd
-(5 rows)
-
-SELECT * FROM spock.repset_add_all_tables('default_insert_only', '{public}');
- repset_add_all_tables 
------------------------
- t
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
- WHERE relname IN ('test_publicschema', 'test_normalschema', 'test_strangeschema', 'test_nopkey') ORDER BY 1,2,3;
-      nspname      |      relname       |         set_name          
--------------------+--------------------+---------------------------
- normalschema      | test_normalschema  | repset_replicate_instrunc
- normalschema      | test_normalschema  | repset_replicate_insupd
- public            | test_nopkey        | default_insert_only
- public            | test_nopkey        | repset_replicate_instrunc
- public            | test_publicschema  | default_insert_only
- public            | test_publicschema  | repset_replicate_all
- strange.schema-IS | test_strangeschema | repset_replicate_insupd
-(7 rows)
-
---too short
-SELECT spock.repset_create('');
-ERROR:  replication set name cannot be empty
--- Can't drop table while it's in a repset
-DROP TABLE public.test_publicschema;
-ERROR:  cannot drop table test_publicschema because other objects depend on it
-DETAIL:  table test_publicschema membership in replication set default_insert_only depends on table test_publicschema
-table test_publicschema membership in replication set repset_replicate_all depends on table test_publicschema
-HINT:  Use DROP ... CASCADE to drop the dependent objects too.
--- Can't drop table while it's in a repset
-BEGIN;
-SELECT spock.replicate_ddl($$
-DROP TABLE public.test_publicschema;
-$$);
-ERROR:  cannot drop table test_publicschema because other objects depend on it
-DETAIL:  table test_publicschema membership in replication set default_insert_only depends on table test_publicschema
-table test_publicschema membership in replication set repset_replicate_all depends on table test_publicschema
-HINT:  Use DROP ... CASCADE to drop the dependent objects too.
-CONTEXT:  during execution of queued SQL statement: 
-DROP TABLE public.test_publicschema;
-
-ROLLBACK;
--- Can CASCADE though, even outside ddlrep
-BEGIN;
-DROP TABLE public.test_publicschema CASCADE;
-NOTICE:  drop cascades to 2 other objects
-DETAIL:  drop cascades to table test_publicschema membership in replication set default_insert_only
-drop cascades to table test_publicschema membership in replication set repset_replicate_all
-ROLLBACK;
--- ... and can drop after repset removal
-SELECT spock.repset_remove_table('repset_replicate_all', 'public.test_publicschema');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT spock.repset_remove_table('default_insert_only', 'public.test_publicschema');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-BEGIN;
-DROP TABLE public.test_publicschema;
-ROLLBACK;
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.test_publicschema CASCADE;
-	DROP SCHEMA normalschema CASCADE;
-	DROP SCHEMA "strange.schema-IS" CASCADE;
-	DROP TABLE public.test_nopkey CASCADE;
-	DROP TABLE public.test_unlogged CASCADE;
-$$);
-NOTICE:  drop cascades to table normalschema.test_normalschema
-NOTICE:  drop cascades to 2 other objects
-NOTICE:  drop cascades to table "strange.schema-IS".test_strangeschema
-NOTICE:  drop cascades to table "strange.schema-IS".test_strangeschema membership in replication set repset_replicate_insupd
-NOTICE:  drop cascades to 2 other objects
- replicate_ddl 
----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spock.replication_set;
-   set_id   | set_nodeid |      set_name       | replicate_insert | replicate_update | replicate_delete | replicate_truncate 
-------------+------------+---------------------+------------------+------------------+------------------+--------------------
- 1814541545 |      52665 | default             | t                | t                | t                | t
- 1909385617 |      52665 | default_insert_only | t                | f                | f                | t
- 2586246310 |      52665 | ddl_sql             | t                | f                | f                | f
-(3 rows)
-
--- Issue SPOC-102
--- Being on subscriber, set the exception behaviour to transdiscard
-ALTER SYSTEM SET spock.exception_behaviour = 'transdiscard';
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :provider_dsn
- -- Table spoc_102g must be on each node and inside the replication set.
-SELECT spock.replicate_ddl('CREATE TABLE spoc_102g (x integer PRIMARY KEY);');
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.repset_add_table('default', 'spoc_102g');
- repset_add_table 
-------------------
- t
-(1 row)
-
--- Must be disabled
-SHOW spock.enable_ddl_replication;
- spock.enable_ddl_replication 
-------------------------------
- off
-(1 row)
-
-SHOW spock.include_ddl_repset;
- spock.include_ddl_repset 
---------------------------
- off
-(1 row)
-
-CREATE TABLE spoc_102l (x integer PRIMARY KEY); -- local for the publisher
-INSERT INTO spoc_102l VALUES (1); -- Should be invisible for the subscriber node.
-INSERT INTO spoc_102g VALUES (-1);
-SELECT spock.repset_add_table('default', 'spoc_102l');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO spoc_102g VALUES (-2);
-INSERT INTO spoc_102l VALUES (2); -- Should cause an error that will be just skipped
-INSERT INTO spoc_102g VALUES (-3);
-BEGIN; -- All its changes must be skipped
-INSERT INTO spoc_102l VALUES (3);
-INSERT INTO spoc_102g VALUES (-4); -- NOT replicated
-END;
-INSERT INTO spoc_102g VALUES (-5);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- Check replication state before the problem fixation
-SELECT * FROM spoc_102g ORDER BY x;
- x  
-----
- -5
- -3
- -2
- -1
-(4 rows)
-
-SELECT * FROM spoc_102l ORDER BY x; -- ERROR, does not exist yet
-ERROR:  relation "spoc_102l" does not exist at character 15
--- Now, fix the issue with absent table
-BEGIN;
-SELECT spock.repair_mode(true) \gset
-CREATE TABLE spoc_102l (x integer PRIMARY KEY);
-END;
--- Check that replication works
-INSERT INTO spoc_102l VALUES (4);
--- XXX: Why we don't synchronize the state of the table and don't see rows
--- publisher has added before?
-SELECT * FROM spoc_102l ORDER BY x;
- x 
----
- 4
-(1 row)
-
--- Return to provider and check that it doesn't see value (4).
--- Afterwards, add value 5 that must be replicated
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
-SELECT * FROM spoc_102l ORDER BY x;
- x 
----
- 1
- 2
- 3
-(3 rows)
-
-INSERT INTO spoc_102l VALUES (5);
--- Re-check that subscription works properly
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spoc_102l ORDER BY x;
- x 
----
- 4
- 5
-(2 rows)
-
---
--- Now, let's check the 'discard' mode
---
-ALTER SYSTEM SET spock.exception_behaviour = 'discard';
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-TRUNCATE spoc_102g;
-SELECT spock.replicate_ddl('DROP TABLE spoc_102l CASCADE');
-NOTICE:  drop cascades to table spoc_102l membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-CREATE TABLE spoc_102l (x integer PRIMARY KEY); -- local for the publisher
-INSERT INTO spoc_102l VALUES (1);
-INSERT INTO spoc_102g VALUES (-1);
-SELECT spock.repset_add_table('default', 'spoc_102l');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO spoc_102g VALUES (-2);
-INSERT INTO spoc_102l VALUES (2); -- table does not exist yet, skip
-INSERT INTO spoc_102g VALUES (-3);
-BEGIN; -- Skip INSERT to spoc_102l and apply INSERT to spoc_102g
-INSERT INTO spoc_102l VALUES (3);
-INSERT INTO spoc_102g VALUES (-4);
-END;
-INSERT INTO spoc_102g VALUES (-5);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- Check replication state before the problem fixation
-SELECT * FROM spoc_102g ORDER BY x;
- x  
-----
- -5
- -4
- -3
- -2
- -1
-(5 rows)
-
-SELECT * FROM spoc_102l ORDER BY x; -- ERROR, does not exist yet
-ERROR:  relation "spoc_102l" does not exist at character 15
--- Now, fix the issue with absent table. Use 'IF NOT EXISTS' hack to create
--- the table where it is absent.
-\c :provider_dsn
-SELECT spock.replicate_ddl('CREATE TABLE IF NOT EXISTS spoc_102l (x integer PRIMARY KEY)');
-NOTICE:  relation "spoc_102l" already exists, skipping
- replicate_ddl 
----------------
- t
-(1 row)
-
-INSERT INTO spoc_102l VALUES (4);
-INSERT INTO spoc_102g VALUES (-6);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL); -- required after changes
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spoc_102g ORDER BY x;
- x  
-----
- -6
- -5
- -4
- -3
- -2
- -1
-(6 rows)
-
-SELECT * FROM spoc_102l ORDER BY x;
- x 
----
- 4
-(1 row)
-
--- Check exception log format
-SELECT
-  command_counter,table_schema,table_name,operation,
-  remote_new_tup,error_message
-FROM spock.exception_log
-ORDER BY command_counter;
- command_counter | table_schema | table_name | operation |                   remote_new_tup                   |       error_message       
------------------+--------------+------------+-----------+----------------------------------------------------+---------------------------
-               1 |              |            | INSERT    |                                                    | Spock can't find relation
-               2 |              |            | INSERT    |                                                    | Spock can't find relation
-               3 | public       | spoc_102g  | INSERT    | [{"value": -4, "attname": "x", "atttype": "int4"}] | unknown
-               4 |              |            | INSERT    |                                                    | Spock can't find relation
-               5 |              |            | INSERT    |                                                    | Spock can't find relation
-               6 | public       | spoc_102g  | INSERT    | [{"value": -4, "attname": "x", "atttype": "int4"}] | unknown
-(6 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl('DROP TABLE IF EXISTS spoc_102g,spoc_102l CASCADE');
-NOTICE:  drop cascades to table spoc_102g membership in replication set default
-NOTICE:  drop cascades to table spoc_102l membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
---
--- UPDATE row of an absent relation
---
-SELECT spock.replicate_ddl('CREATE TABLE spoc_102g_u (x integer PRIMARY KEY);');
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.repset_add_table('default', 'spoc_102g_u');
- repset_add_table 
-------------------
- t
-(1 row)
-
-CREATE TABLE spoc_102l_u (x integer PRIMARY KEY); -- local for the publisher
-INSERT INTO spoc_102l_u VALUES (1);
-INSERT INTO spoc_102g_u VALUES (-1), (0);
-SELECT spock.repset_add_table('default', 'spoc_102l_u');
- repset_add_table 
-------------------
- t
-(1 row)
-
-UPDATE spoc_102g_u SET x = -2 WHERE x = -1;
-UPDATE spoc_102l_u SET x = 2 WHERE x = 1;
-BEGIN;
-UPDATE spoc_102l_u SET x = 3 WHERE x = 2;
-UPDATE spoc_102g_u SET x = -3 WHERE x = -2;
-END;
-UPDATE spoc_102g_u SET x = 1 WHERE x = 0;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- Check replication state before the problem fixation
-SELECT * FROM spoc_102g_u ORDER BY x;
- x  
-----
- -3
-  1
-(2 rows)
-
-SELECT * FROM spoc_102l_u ORDER BY x; -- ERROR, does not exist yet
-ERROR:  relation "spoc_102l_u" does not exist at character 15
--- Now, fix the issue with absent table
-\c :provider_dsn
-SELECT spock.replicate_ddl('CREATE TABLE IF NOT EXISTS spoc_102l_u (x integer PRIMARY KEY)');
-NOTICE:  relation "spoc_102l_u" already exists, skipping
- replicate_ddl 
----------------
- t
-(1 row)
-
-UPDATE spoc_102l_u SET x = -3 WHERE x = 3;
-INSERT INTO spoc_102l_u VALUES (4);
-UPDATE spoc_102l_u SET x = 5 WHERE x = 4;
--- Check that replication works
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL); -- required
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT * FROM spoc_102l_u ORDER BY x;
- x 
----
- 5
-(1 row)
-
-SELECT * FROM spoc_102g_u ORDER BY x;
- x  
-----
- -3
-  1
-(2 rows)
-
-SELECT
-  command_counter,table_schema,table_name,operation,
-  remote_new_tup,error_message
-FROM spock.exception_log
-ORDER BY command_counter;
- command_counter | table_schema | table_name  | operation |                   remote_new_tup                   |                                             error_message                                              
------------------+--------------+-------------+-----------+----------------------------------------------------+--------------------------------------------------------------------------------------------------------
-               1 |              |             | INSERT    |                                                    | Spock can't find relation
-               2 |              |             | INSERT    |                                                    | Spock can't find relation
-               3 | public       | spoc_102g   | INSERT    | [{"value": -4, "attname": "x", "atttype": "int4"}] | unknown
-               4 |              |             | INSERT    |                                                    | Spock can't find relation
-               5 |              |             | INSERT    |                                                    | Spock can't find relation
-               6 | public       | spoc_102g   | INSERT    | [{"value": -4, "attname": "x", "atttype": "int4"}] | unknown
-               7 |              |             | UPDATE    |                                                    | Spock can't find relation
-               8 |              |             | UPDATE    |                                                    | Spock can't find relation
-               9 | public       | spoc_102g_u | UPDATE    | [{"value": -3, "attname": "x", "atttype": "int4"}] | unknown
-              10 | public       | spoc_102l_u | UPDATE    | [{"value": -3, "attname": "x", "atttype": "int4"}] | logical replication did not find row to be updated in replication target relation (public.spoc_102l_u)
-(10 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl('DROP TABLE IF EXISTS spoc_102g_u,spoc_102l_u CASCADE');
-NOTICE:  drop cascades to table spoc_102g_u membership in replication set default
-NOTICE:  drop cascades to table spoc_102l_u membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
---
--- DELETE row from an absent relation
---
-SELECT spock.replicate_ddl('CREATE TABLE spoc_102g_d (x integer PRIMARY KEY);');
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.repset_add_table('default', 'spoc_102g_d');
- repset_add_table 
-------------------
- t
-(1 row)
-
-CREATE TABLE spoc_102l_d (x integer PRIMARY KEY);
-INSERT INTO spoc_102l_d VALUES (1), (2);
-INSERT INTO spoc_102g_d VALUES (-1), (-2), (-3);
-SELECT spock.repset_add_table('default', 'spoc_102l_d');
- repset_add_table 
-------------------
- t
-(1 row)
-
-DELETE FROM spoc_102g_d WHERE x = -1;
-DELETE FROM spoc_102l_d WHERE x = 1;
-DELETE FROM spoc_102g_d WHERE x = -2;
--- Check the state of replication on the subscriber node
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL); -- required
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spoc_102l_d ORDER BY x; -- ERROR, not existed yet.
-ERROR:  relation "spoc_102l_d" does not exist at character 15
-SELECT * FROM spoc_102g_d ORDER BY x; -- See one record (-3).
- x  
-----
- -3
-(1 row)
-
--- Create table where needed
-\c :provider_dsn
-SELECT spock.replicate_ddl('CREATE TABLE IF NOT EXISTS spoc_102l_d (x integer PRIMARY KEY)');
-NOTICE:  relation "spoc_102l_d" already exists, skipping
- replicate_ddl 
----------------
- t
-(1 row)
-
--- Do something with tables to enable replication
-INSERT INTO spoc_102g_d VALUES (-4), (-5);
-INSERT INTO spoc_102l_d VALUES (3), (4);
-UPDATE spoc_102g_d SET x = -6 WHERE x = -4;
-UPDATE spoc_102l_d SET x = 5 WHERE x = 3;
-DELETE FROM spoc_102g_d WHERE x = -3 OR x = -6;
-DELETE FROM spoc_102l_d WHERE x = 1 OR x = 5;
--- Check the state of replication on the subscriber node
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL); -- required
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spoc_102l_d ORDER BY x; -- See (4)
- x 
----
- 4
-(1 row)
-
-SELECT * FROM spoc_102g_d ORDER BY x; -- See (-5).
- x  
-----
- -5
-(1 row)
-
--- Cleanup
-\c :provider_dsn
-SELECT spock.replicate_ddl('DROP TABLE IF EXISTS spoc_102g_d,spoc_102l_d CASCADE');
-NOTICE:  drop cascades to table spoc_102g_d membership in replication set default
-NOTICE:  drop cascades to table spoc_102l_d membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/matview.out /Users/pgedge/pgedge/spock-ibrar/results/matview.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/matview.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/matview.out	2025-12-04 16:02:53
@@ -1,154 +1,7 @@
 /* First test whether a table's replication set can be properly manipulated */
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.test_tbl(id serial primary key, data text);
-CREATE MATERIALIZED VIEW public.test_mv AS (SELECT * FROM public.test_tbl);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_all_tables('default', '{public}');
- repset_add_all_tables 
------------------------
- t
-(1 row)
-
-INSERT INTO test_tbl VALUES (1, 'a');
-REFRESH MATERIALIZED VIEW test_mv;
-INSERT INTO test_tbl VALUES (2, 'b');
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT * FROM test_tbl ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-(2 rows)
-
-SELECT * FROM test_mv ORDER BY id;
- id | data 
-----+------
-  1 | a
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM test_tbl ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-(2 rows)
-
-SELECT * FROM test_mv ORDER BY id;
- id | data 
-----+------
-(0 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-  CREATE UNIQUE INDEX ON public.test_mv(id);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-INSERT INTO test_tbl VALUES (3, 'c');
-REFRESH MATERIALIZED VIEW CONCURRENTLY test_mv;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO test_tbl VALUES (4, 'd');
-SELECT spock.replicate_ddl($$
-  REFRESH MATERIALIZED VIEW public.test_mv;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO test_tbl VALUES (5, 'e');
-SELECT spock.replicate_ddl($$
-  REFRESH MATERIALIZED VIEW CONCURRENTLY public.test_mv;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT * FROM test_tbl ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-  3 | c
-  4 | d
-  5 | e
-(5 rows)
-
-SELECT * FROM test_mv ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-  3 | c
-  4 | d
-  5 | e
-(5 rows)
-
-\c :subscriber_dsn
-SELECT * FROM test_tbl ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-  3 | c
-  4 | d
-  5 | e
-(5 rows)
-
-SELECT * FROM test_mv ORDER BY id;
- id | data 
-----+------
-  1 | a
-  2 | b
-  3 | c
-  4 | d
-  5 | e
-(5 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.test_tbl CASCADE;
-$$);
-NOTICE:  drop cascades to materialized view test_mv
-NOTICE:  drop cascades to table test_tbl membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/bidirectional.out /Users/pgedge/pgedge/spock-ibrar/results/bidirectional.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/bidirectional.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/bidirectional.out	2025-12-04 16:02:53
@@ -1,134 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT E'\'' || current_database() || E'\'' AS pubdb;
-    pubdb     
---------------
- 'regression'
-(1 row)
-
-\gset
-\c :provider_dsn
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_bidirectional',
-    provider_dsn := (SELECT subscriber_dsn FROM spock_regress_variables()) || ' user=super',
-    synchronize_structure := false,
-    synchronize_data := false,
-    forward_origins := '{}');
- sub_create 
-------------
-          1
-(1 row)
-
-BEGIN;
-SET LOCAL statement_timeout = '10s';
-SELECT spock.sub_wait_for_sync('test_bidirectional');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-\c :subscriber_dsn
-SELECT spock.replicate_ddl($$
-    CREATE TABLE public.basic_dml (
-        id serial primary key,
-        other integer,
-        data text,
-        something interval
-    );
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
-SELECT * FROM spock.repset_add_table('default', 'basic_dml');
- repset_add_table 
-------------------
- t
-(1 row)
-
--- check basic insert replication
-INSERT INTO basic_dml(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(5 rows)
-
-UPDATE basic_dml SET other = id, something = something - '10 seconds'::interval WHERE id < 3;
-UPDATE basic_dml SET other = id, something = something + '10 seconds'::interval WHERE id > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
-SELECT id, other, data, something FROM basic_dml ORDER BY id;
- id | other | data |        something        
-----+-------+------+-------------------------
-  1 |     1 | foo  | @ 50 secs
-  2 |     2 | bar  | @ 84 days -10 secs
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     4 | qux  | @ 8 mons 2 days 10 secs
-  5 |     5 |      | 
-(5 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-    DROP TABLE public.basic_dml CASCADE;
-$$);
-NOTICE:  drop cascades to table basic_dml membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.sub_drop('test_bidirectional');
- sub_drop 
-----------
-        1
-(1 row)
-
-SET client_min_messages = 'warning';
-\c :subscriber_dsn
-\a
-SELECT slot_name FROM pg_replication_slots WHERE database = current_database();
-slot_name
-(0 rows)
-SELECT count(*) FROM pg_stat_replication WHERE application_name = 'test_bidirectional';
-count
-0
-(1 row)
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/primary_key.out /Users/pgedge/pgedge/spock-ibrar/results/primary_key.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/primary_key.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/primary_key.out	2025-12-04 16:02:53
@@ -1,773 +1,8 @@
 --PRIMARY KEY
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 -- This is to ensure that the test runs with the correct configuration
 \c :provider_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = true;
-ALTER SYSTEM SET spock.exception_behaviour = sub_disable;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = true;
-ALTER SYSTEM SET spock.exception_behaviour = sub_disable;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :provider_dsn
--- testing update of primary key
--- create  table with primary key and 3 other tables referencing it
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.pk_users (
-    id integer PRIMARY KEY,
-    another_id integer unique not null,
-    a_id integer,
-    name text,
-    address text
-);
-
---pass
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'pk_users');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO pk_users VALUES(1,11,1,'User1', 'Address1');
-INSERT INTO pk_users VALUES(2,12,1,'User2', 'Address2');
-INSERT INTO pk_users VALUES(3,13,2,'User3', 'Address3');
-INSERT INTO pk_users VALUES(4,14,2,'User4', 'Address4');
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  | address  
-----+------------+------+-------+----------
-  1 |         11 |    1 | User1 | Address1
-  2 |         12 |    1 | User2 | Address2
-  3 |         13 |    2 | User3 | Address3
-  4 |         14 |    2 | User4 | Address4
-(4 rows)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'pk_users'::regclass and attnum > 0 order by attnum;
-  attname   | attnotnull | attisdropped 
-------------+------------+--------------
- id         | t          | f
- another_id | t          | f
- a_id       | f          | f
- name       | f          | f
- address    | f          | f
-(5 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  | address  
-----+------------+------+-------+----------
-  1 |         11 |    1 | User1 | Address1
-  2 |         12 |    1 | User2 | Address2
-  3 |         13 |    2 | User3 | Address3
-  4 |         14 |    2 | User4 | Address4
-(4 rows)
-
-\c :provider_dsn
-UPDATE pk_users SET address='UpdatedAddress1' WHERE id=1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  |     address     
-----+------------+------+-------+-----------------
-  1 |         11 |    1 | User1 | UpdatedAddress1
-  2 |         12 |    1 | User2 | Address2
-  3 |         13 |    2 | User3 | Address3
-  4 |         14 |    2 | User4 | Address4
-(4 rows)
-
--- Set up for secondary unique index and two-index
--- conflict handling cases.
-INSERT INTO pk_users VALUES (5000,5000,0,'sub1',NULL);
-INSERT INTO pk_users VALUES (6000,6000,0,'sub2',NULL);
-\c :provider_dsn
--- Resolve a conflict on the secondary unique constraint
-INSERT INTO pk_users VALUES (5001,5000,1,'pub1',NULL);
--- And a conflict that violates two constraints
-INSERT INTO pk_users VALUES (6000,6000,1,'pub2',NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users WHERE id IN (5000,5001,6000) ORDER BY id;
-  id  | another_id | a_id | name | address 
-------+------------+------+------+---------
- 5001 |       5000 |    1 | pub1 | 
- 6000 |       6000 |    1 | pub2 | 
-(2 rows)
-
-\c :provider_dsn
-DELETE FROM pk_users WHERE id IN (5000,5001,6000);
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-CREATE UNIQUE INDEX another_id_temp_idx ON public.pk_users (another_id);
-ALTER TABLE public.pk_users DROP CONSTRAINT pk_users_pkey,
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY USING INDEX another_id_temp_idx;
-
-ALTER TABLE public.pk_users DROP CONSTRAINT pk_users_another_id_key;
-$$);
-NOTICE:  ALTER TABLE / ADD CONSTRAINT USING INDEX will rename index "another_id_temp_idx" to "pk_users_pkey"
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'pk_users'::regclass and attnum > 0 order by attnum;
-  attname   | attnotnull | attisdropped 
-------------+------------+--------------
- id         | t          | f
- another_id | t          | f
- a_id       | f          | f
- name       | f          | f
- address    | f          | f
-(5 rows)
-
-UPDATE pk_users SET address='UpdatedAddress2' WHERE id=2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'pk_users'::regclass and attnum > 0 order by attnum;
-  attname   | attnotnull | attisdropped 
-------------+------------+--------------
- id         | t          | f
- another_id | t          | f
- a_id       | f          | f
- name       | f          | f
- address    | f          | f
-(5 rows)
-
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  |     address     
-----+------------+------+-------+-----------------
-  1 |         11 |    1 | User1 | UpdatedAddress1
-  2 |         12 |    1 | User2 | UpdatedAddress2
-  3 |         13 |    2 | User3 | Address3
-  4 |         14 |    2 | User4 | Address4
-(4 rows)
-
-\c :provider_dsn
-UPDATE pk_users SET address='UpdatedAddress3' WHERE another_id=12;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  |     address     
-----+------------+------+-------+-----------------
-  1 |         11 |    1 | User1 | UpdatedAddress1
-  2 |         12 |    1 | User2 | UpdatedAddress3
-  3 |         13 |    2 | User3 | Address3
-  4 |         14 |    2 | User4 | Address4
-(4 rows)
-
-\c :provider_dsn
-UPDATE pk_users SET address='UpdatedAddress4' WHERE a_id=2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-INSERT INTO pk_users VALUES(4,15,2,'User5', 'Address5');
--- subscriber now has duplicated value in id field while provider does not
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  |     address     
-----+------------+------+-------+-----------------
-  1 |         11 |    1 | User1 | UpdatedAddress1
-  2 |         12 |    1 | User2 | UpdatedAddress3
-  3 |         13 |    2 | User3 | UpdatedAddress4
-  4 |         14 |    2 | User4 | UpdatedAddress4
-  4 |         15 |    2 | User5 | Address5
-(5 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT quote_literal(pg_current_wal_lsn()) as curr_lsn
-\gset
-SELECT spock.replicate_ddl($$
-CREATE UNIQUE INDEX id_temp_idx ON public.pk_users (id);
-ALTER TABLE public.pk_users DROP CONSTRAINT pk_users_pkey,
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY USING INDEX id_temp_idx;
-$$);
-NOTICE:  ALTER TABLE / ADD CONSTRAINT USING INDEX will rename index "id_temp_idx" to "pk_users_pkey"
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'pk_users'::regclass and attnum > 0 order by attnum;
-  attname   | attnotnull | attisdropped 
-------------+------------+--------------
- id         | t          | f
- another_id | t          | f
- a_id       | f          | f
- name       | f          | f
- address    | f          | f
-(5 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, :curr_lsn);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT attname, attnotnull, attisdropped from pg_attribute where attrelid = 'pk_users'::regclass and attnum > 0 order by attnum;
-  attname   | attnotnull | attisdropped 
-------------+------------+--------------
- id         | t          | f
- another_id | t          | f
- a_id       | f          | f
- name       | f          | f
- address    | f          | f
-(5 rows)
-
-select status from spock.sub_show_status();
-  status  
-----------
- disabled
-(1 row)
-
-\c :provider_dsn
--- Wait for subscription to disconnect. It will have been bouncing already
--- due to apply worker restarts, but if it was retrying it'll stay down
--- this time.
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF (SELECT count(1) FROM pg_replication_slots WHERE active = false) THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-SELECT data::json->'action' as action, CASE WHEN data::json->>'action' IN ('I', 'D', 'U') THEN json_extract_path(data::json, 'relation') END as data FROM pg_logical_slot_get_changes((SELECT slot_name FROM pg_replication_slots), NULL, 1, 'min_proto_version', '3', 'max_proto_version', '4', 'startup_params_format', '1', 'proto_format', 'json', 'spock.replication_set_names', 'default,ddl_sql')
-WHERE data IS NOT NULL AND data <> '';
- action |       data        
---------+-------------------
- "S"    | 
- "B"    | 
- "I"    | ["spock","queue"]
- "C"    | 
-(4 rows)
-
-SELECT data::json->'action' as action, CASE WHEN data::json->>'action' IN ('I', 'D', 'U') THEN data END as data FROM pg_logical_slot_get_changes((SELECT slot_name FROM pg_replication_slots), NULL, 1, 'min_proto_version', '3', 'max_proto_version', '4', 'startup_params_format', '1', 'proto_format', 'json', 'spock.replication_set_names', 'default,ddl_sql')
-WHERE data IS NOT NULL AND data <> '';
- action | data 
---------+------
-(0 rows)
-
-\c :subscriber_dsn
-DELETE FROM pk_users WHERE id = 4;-- remove the offending entries.
-SELECT spock.sub_enable('test_subscription', true);
- sub_enable 
-------------
- t
-(1 row)
-
-\c :provider_dsn
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF (SELECT count(1) FROM pg_replication_slots WHERE active = true) THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-UPDATE pk_users SET address='UpdatedAddress2' WHERE id=2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name  |     address     
-----+------------+------+-------+-----------------
-  1 |         11 |    1 | User1 | UpdatedAddress1
-  2 |         12 |    1 | User2 | UpdatedAddress2
-  3 |         13 |    2 | User3 | UpdatedAddress4
-(3 rows)
-
-\c :provider_dsn
---
--- Test to show that we don't defend against alterations to tables
--- that will break replication once added to a repset, or prevent
--- dml that would break on apply.
---
--- See 2ndQuadrant/spock_internal#146
---
--- Show that the current PK is not marked 'indisreplident' because we use
--- REPLICA IDENTITY DEFAULT
-SELECT indisreplident FROM pg_index WHERE indexrelid = 'pk_users_pkey'::regclass;
- indisreplident 
-----------------
- f
-(1 row)
-
-SELECT relreplident FROM pg_class WHERE oid = 'pk_users'::regclass;
- relreplident 
---------------
- d
-(1 row)
-
-SELECT spock.replicate_ddl($$
-ALTER TABLE public.pk_users DROP CONSTRAINT pk_users_pkey;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-INSERT INTO pk_users VALUES(90,0,0,'User90', 'Address90');
--- spock will stop us adding the table to a repset if we try to,
--- but didn't stop us altering it, and won't stop us updating it...
-BEGIN;
-SELECT * FROM spock.repset_remove_table('default', 'pk_users');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'pk_users');
-ERROR:  table pk_users cannot be added to replication set default
-ROLLBACK;
---
--- Previously this would cause an error on the subscriber:
---      remote UPDATE on relation public.pk_users (tuple not found).
--- In Spock's, this will be caught and the subscription will be disabled when
--- spock.exception_behaviour = sub_disable is set.
---
-UPDATE pk_users SET id = 91 WHERE id = 90;
--- feth xid of the last 'U' action
-SELECT fetch_last_xid('U') AS remote_xid \gset
--- To carry on we'll need to make the index on the downstream
--- We need to skip the last 'U' action that caused the subscription to be disabled.
--- Its done by altering the subscription to skip the last 'U' action and the error
--- message from the exception log is used to find the skip_lsn.
-\c :subscriber_dsn
-SELECT skiplsn_and_enable_sub('test_subscription', :remote_xid);
- skiplsn_and_enable_sub 
-------------------------
- 
-(1 row)
-
-ALTER TABLE public.pk_users
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY (id) NOT DEFERRABLE;
-\c :provider_dsn
-ALTER TABLE public.pk_users
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY (id) NOT DEFERRABLE;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- Demonstrate that deferrable indexes aren't yet supported for updates on downstream
--- and will fail with an informative error.
-SELECT spock.replicate_ddl($$
-ALTER TABLE public.pk_users
-    DROP CONSTRAINT pk_users_pkey,
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY (id) DEFERRABLE INITIALLY DEFERRED;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
--- Not allowed, deferrable
-ALTER TABLE public.pk_users REPLICA IDENTITY USING INDEX pk_users_pkey;
-ERROR:  cannot use non-immediate index "pk_users_pkey" as replica identity
--- New index isn't REPLICA IDENTITY either
-SELECT indisreplident FROM pg_index WHERE indexrelid = 'pk_users_pkey'::regclass;
- indisreplident 
-----------------
- f
-(1 row)
-
--- spock won't let us add the table to a repset, though
--- it doesn't stop us altering it; see 2ndQuadrant/spock_internal#146
-BEGIN;
-SELECT * FROM spock.repset_remove_table('default', 'pk_users');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'pk_users');
-ERROR:  table pk_users cannot be added to replication set default
-ROLLBACK;
--- We can still INSERT (which is fine)
-INSERT INTO pk_users VALUES(100,0,0,'User100', 'Address100');
--- FIXME spock shouldn't allow this, no valid replica identity exists
--- see 2ndQuadrant/spock_internal#146
-UPDATE pk_users SET id = 101 WHERE id = 100;
--- Must time out, apply will fail on downstream due to no replident index
-BEGIN;
-SET LOCAL statement_timeout = '2s';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
-ERROR:  canceling statement due to statement timeout
-ROLLBACK;
-\c :subscriber_dsn
--- entry 100 must be absent since we can't apply it without
--- a suitable pk
-SELECT id FROM pk_users WHERE id IN (90, 91, 100, 101) ORDER BY id;
- id  
------
-  90
- 100
-(2 rows)
-
-SELECT spock.sub_show_status();
-                                                                        sub_show_status                                                                        
----------------------------------------------------------------------------------------------------------------------------------------------------------------
- (test_subscription,disabled,test_provider,"dbname=regression user=super",spk_postgres_test_provider_test_sube55bf37,"{default,default_insert_only,ddl_sql}",)
-(1 row)
-
--- we can recover by re-creating the pk as non-deferrable
-ALTER TABLE public.pk_users DROP CONSTRAINT pk_users_pkey,
-    ADD CONSTRAINT pk_users_pkey PRIMARY KEY (id) NOT DEFERRABLE;
--- then replay. Toggle the subscription's enabled state
--- to make it recover faster for a quicker test run.
--- sub is already disabled due to the previous
-SELECT spock.sub_enable('test_subscription', true);
- sub_enable 
-------------
- t
-(1 row)
-
--- \c :provider_dsn
--- SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
-\c :subscriber_dsn
-SELECT id FROM pk_users WHERE id IN (90, 91, 100, 101) ORDER BY id;
- id  
------
-  90
- 100
-(2 rows)
-
-\c :provider_dsn
--- Subscriber and provider have diverged due to inability to replicate
--- the UPDATEs
-SELECT id FROM pk_users WHERE id IN (90, 91, 100, 101) ORDER BY id;
- id  
------
-  91
- 101
-(2 rows)
-
-\c :provider_dsn
--- feth xid of the last 'U' action
-SELECT fetch_last_xid('U') AS remote_xid \gset
--- To carry on we'll need to make the index on the downstream
--- We need to skip the last 'U' action that caused the subscription to be disabled.
--- Its done by altering the subscription to skip the last 'U' action and the error
--- message from the exception log is used to find the skip_lsn.
-\c :subscriber_dsn
-SELECT skiplsn_and_enable_sub('test_subscription', :remote_xid);
- skiplsn_and_enable_sub 
-------------------------
- 
-(1 row)
-
--- Demonstrate that we properly handle wide conflict rows
-\c :subscriber_dsn
-INSERT INTO pk_users (id, another_id, address)
-VALUES (200,2000,repeat('waah daah sooo mooo', 1000));
-\c :provider_dsn
-INSERT INTO pk_users (id, another_id, address)
-VALUES (200,2000,repeat('boop boop doop boop', 1000));
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- wait until subscription status updated.
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF (SELECT count(1) FROM spock.subscription WHERE sub_enabled = true) THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-SELECT id, another_id, left(address,30) AS address_abbrev
-FROM pk_users WHERE another_id = 2000;
- id  | another_id |         address_abbrev         
------+------------+--------------------------------
- 200 |       2000 | boop boop doop boopboop boop d
-(1 row)
-
--- DELETE conflicts; the DELETE is discarded
-\c :subscriber_dsn
-DELETE FROM pk_users WHERE id = 1;
-\c :provider_dsn
-DELETE FROM pk_users WHERE id = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- UPDATE conflicts violating multiple constraints.
--- For this one we need to put the secondary unique
--- constraint back.
-TRUNCATE TABLE pk_users;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT spock.replicate_ddl($$
-  CREATE UNIQUE INDEX pk_users_another_id_idx ON public.pk_users(another_id);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-INSERT INTO pk_users VALUES
-(1,10,0,'sub',NULL),
-(2,20,0,'sub',NULL);
-\c :provider_dsn
-INSERT INTO pk_users VALUES
-(3,11,1,'pub',NULL),
-(4,22,1,'pub',NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id | name | address 
-----+------------+------+------+---------
-  1 |         10 |    0 | sub  | 
-  2 |         20 |    0 | sub  | 
-  3 |         11 |    1 | pub  | 
-  4 |         22 |    1 | pub  | 
-(4 rows)
-
-\c :provider_dsn
--- UPDATE one of our upstream tuples to violate both constraints on the
--- downstream. The constraints are independent but there's only one existing
--- downstream tuple that violates both constraints. We'll match it by replica
--- identity, replace it, and satisfy the other constraint in the process.
-UPDATE pk_users SET id=1, another_id = 10, name='should_error' WHERE id = 3 AND another_id = 11;
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |     name     | address 
-----+------------+------+--------------+---------
-  1 |         10 |    1 | should_error | 
-  4 |         22 |    1 | pub          | 
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT spock.sub_show_status();
-                                                                         sub_show_status                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
- (test_subscription,replicating,test_provider,"dbname=regression user=super",spk_postgres_test_provider_test_sube55bf37,"{default,default_insert_only,ddl_sql}",)
-(1 row)
-
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |     name     | address 
-----+------------+------+--------------+---------
-  1 |         10 |    1 | should_error | 
-  2 |         20 |    0 | sub          | 
-  3 |         11 |    1 | pub          | 
-  4 |         22 |    1 | pub          | 
-(4 rows)
-
--- UPDATEs to missing rows could either resurrect the row or conclude it
--- shouldn't exist and discard it. Currently spk unconditionally discards, so
--- this row's name is a misnomer.
-\c :subscriber_dsn
-SELECT spock.sub_show_status();
-                                                                         sub_show_status                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
- (test_subscription,replicating,test_provider,"dbname=regression user=super",spk_postgres_test_provider_test_sube55bf37,"{default,default_insert_only,ddl_sql}",)
-(1 row)
-
-DELETE FROM pk_users WHERE id = 4 AND another_id = 22;
-\c :provider_dsn
-UPDATE pk_users SET name = 'jesus' WHERE id = 4;
--- fetch xid of the last 'U' action
-SELECT fetch_last_xid('U') AS remote_xid \gset
---SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
-\c :subscriber_dsn
-SELECT spock.sub_show_status();     -- SUB is disabled due to the previous UPDATE
-                                                                        sub_show_status                                                                        
----------------------------------------------------------------------------------------------------------------------------------------------------------------
- (test_subscription,disabled,test_provider,"dbname=regression user=super",spk_postgres_test_provider_test_sube55bf37,"{default,default_insert_only,ddl_sql}",)
-(1 row)
-
-SELECT skiplsn_and_enable_sub('test_subscription', :remote_xid);
- skiplsn_and_enable_sub 
-------------------------
- 
-(1 row)
-
--- No resurrection here
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |     name     | address 
-----+------------+------+--------------+---------
-  1 |         10 |    1 | should_error | 
-  2 |         20 |    0 | sub          | 
-  3 |         11 |    1 | pub          | 
-(3 rows)
-
--- But if the UPDATE would create a row that violates
--- a secondary unique index (but doesn't match the replident)
--- we'll ERROR on the secondary index.
-INSERT INTO pk_users VALUES (5,55,0,'sub',NULL);
-\c :provider_dsn
-INSERT INTO pk_users VALUES (6,66,0,'sub',NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- The new row (6,55) will conflict with (5,55)
-UPDATE pk_users SET another_id = 55, name = 'pub_should_error' WHERE id = 6;
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |       name       | address 
-----+------------+------+------------------+---------
-  1 |         10 |    1 | should_error     | 
-  4 |         22 |    1 | jesus            | 
-  6 |         55 |    0 | pub_should_error | 
-(3 rows)
-
--- We'll time out due to apply errors
-BEGIN;
-SET LOCAL statement_timeout = '2s';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
-ERROR:  canceling statement due to statement timeout
-ROLLBACK;
--- This time we'll fix it by deleting the conflicting row
--- Since SUB is disabled, DELETE the row on the subscriber
--- and then re-enable the subscription.
-\c :subscriber_dsn
-SELECT spock.sub_show_status();
-                                                                        sub_show_status                                                                        
----------------------------------------------------------------------------------------------------------------------------------------------------------------
- (test_subscription,disabled,test_provider,"dbname=regression user=super",spk_postgres_test_provider_test_sube55bf37,"{default,default_insert_only,ddl_sql}",)
-(1 row)
-
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |     name     | address 
-----+------------+------+--------------+---------
-  1 |         10 |    1 | should_error | 
-  2 |         20 |    0 | sub          | 
-  3 |         11 |    1 | pub          | 
-  5 |         55 |    0 | sub          | 
-  6 |         66 |    0 | sub          | 
-(5 rows)
-
-DELETE FROM pk_users WHERE id = 5;
-SELECT spock.sub_enable('test_subscription', true);
- sub_enable 
-------------
- t
-(1 row)
-
-\c :provider_dsn
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM pk_users ORDER BY id;
- id | another_id | a_id |       name       | address 
-----+------------+------+------------------+---------
-  1 |         10 |    1 | should_error     | 
-  2 |         20 |    0 | sub              | 
-  3 |         11 |    1 | pub              | 
-  6 |         55 |    0 | pub_should_error | 
-(4 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.pk_users CASCADE;
-$$);
-NOTICE:  drop cascades to table pk_users membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
--- Reset the configuration to the default value
-\c :provider_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = false;
-ALTER SYSTEM SET spock.exception_behaviour = transdiscard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = false;
-ALTER SYSTEM SET spock.exception_behaviour = transdiscard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/interfaces.out /Users/pgedge/pgedge/spock-ibrar/results/interfaces.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/interfaces.out	2025-11-20 18:20:49
+++ /Users/pgedge/pgedge/spock-ibrar/results/interfaces.out	2025-12-04 16:02:53
@@ -1,126 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-CREATE USER super2 SUPERUSER;
-\c :subscriber_dsn
-SELECT * FROM spock.node_add_interface('test_provider', 'super2', (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super2');
- node_add_interface 
---------------------
-         1679954453
-(1 row)
-
--- Check that the signal_worker_xact_callback routine process subscription
--- change in a right way, considering abortion and prepared transactions.
-BEGIN;
-SELECT * FROM spock.sub_alter_interface('test_subscription', 'super2');
- sub_alter_interface 
----------------------
- t
-(1 row)
-
-ROLLBACK;
-BEGIN;
-SELECT * FROM spock.sub_alter_interface('test_subscription', 'super2');
- sub_alter_interface 
----------------------
- t
-(1 row)
-
-PREPARE TRANSACTION 't1';
-ABORT PREPARED 't1'; -- ERROR between preparation and abortion
-ERROR:  syntax error at or near "PREPARED"
-LINE 1: ABORT PREPARED 't1';
-              ^
-ROLLBACK PREPARED 't1';
-BEGIN;
-SAVEPOINT s1;
-SELECT * FROM spock.sub_alter_interface('test_subscription', 'super2');
- sub_alter_interface 
----------------------
- t
-(1 row)
-
-ROLLBACK TO SAVEPOINT s1;
-COMMIT;
-SELECT * FROM spock.sub_alter_interface('test_subscription', 'super2');
- sub_alter_interface 
----------------------
- t
-(1 row)
-
-DO $$
-BEGIN
-    WHILE EXISTS (SELECT 1 FROM spock.sub_show_status() WHERE status = 'down')
-	LOOP
-    END LOOP;
-END;$$;
-SELECT
-  subscription_name, status, provider_node, replication_sets, forward_origins
-FROM spock.sub_show_status();
- subscription_name |   status    | provider_node |           replication_sets            | forward_origins 
--------------------+-------------+---------------+---------------------------------------+-----------------
- test_subscription | replicating | test_provider | {default,default_insert_only,ddl_sql} | 
-(1 row)
-
-\c :provider_dsn
-DO $$
-BEGIN
-    WHILE EXISTS (SELECT 1 FROM pg_replication_slots WHERE active = 'false')
-	LOOP
-    END LOOP;
-END;$$;
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
-(1 row)
-
-SELECT usename FROM pg_stat_replication WHERE application_name = 'test_subscription';
- usename 
----------
-(0 rows)
-
-\c :subscriber_dsn
-SELECT * FROM spock.sub_alter_interface('test_subscription', 'test_provider');
- sub_alter_interface 
----------------------
- t
-(1 row)
-
-DO $$
-BEGIN
-    WHILE EXISTS (SELECT 1 FROM spock.sub_show_status() WHERE status = 'down')
-	LOOP
-	-- TODO: The multimaster testing buildfarm should have a general parameter
-	-- like 'wait_change_timeout' that may be used to take control over infinite
-	-- waiting cycles.
-    END LOOP;
-END;$$;
-SELECT
-  subscription_name, status, provider_node, replication_sets, forward_origins
-FROM spock.sub_show_status();
- subscription_name |   status    | provider_node |           replication_sets            | forward_origins 
--------------------+-------------+---------------+---------------------------------------+-----------------
- test_subscription | replicating | test_provider | {default,default_insert_only,ddl_sql} | 
-(1 row)
-
-\c :provider_dsn
-DROP USER super2;
--- Creation of a slot needs some time. Just wait.
-DO $$
-BEGIN
-    WHILE EXISTS (SELECT 1 FROM pg_replication_slots WHERE active = 'false')
-	LOOP
-    END LOOP;
-END;$$;
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
-(1 row)
-
-SELECT usename FROM pg_stat_replication WHERE application_name = 'test_subscription';
- usename 
----------
-(0 rows)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/foreign_key.out /Users/pgedge/pgedge/spock-ibrar/results/foreign_key.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/foreign_key.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/foreign_key.out	2025-12-04 16:02:53
@@ -1,84 +1,7 @@
 --FOREIGN KEY
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.f1k_products (
-    product_no integer PRIMARY KEY,
-    product_id integer,
-    name text,
-    price numeric
-);
-
-CREATE TABLE public.f1k_orders (
-    order_id integer,
-    product_no integer REFERENCES public.f1k_products (product_no),
-    quantity integer
-);
---pass
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'f1k_products');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default_insert_only', 'f1k_orders');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT into public.f1k_products VALUES (1, 1, 'product1', 1.20);
-INSERT into public.f1k_products VALUES (2, 2, 'product2', 2.40);
-INSERT into public.f1k_orders VALUES (300, 1, 4);
-INSERT into public.f1k_orders VALUES (22, 2, 14);
-INSERT into public.f1k_orders VALUES (23, 2, 24);
-INSERT into public.f1k_orders VALUES (24, 2, 40);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.f1k_products;
- product_no | product_id |   name   | price 
-------------+------------+----------+-------
-          1 |          1 | product1 |  1.20
-          2 |          2 | product2 |  2.40
-(2 rows)
-
-SELECT * FROM public.f1k_orders;
- order_id | product_no | quantity 
-----------+------------+----------
-      300 |          1 |        4
-       22 |          2 |       14
-       23 |          2 |       24
-       24 |          2 |       40
-(4 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.f1k_orders CASCADE;
-	DROP TABLE public.f1k_products CASCADE;
-$$);
-NOTICE:  drop cascades to table f1k_orders membership in replication set default_insert_only
-NOTICE:  drop cascades to table f1k_products membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/copy.out /Users/pgedge/pgedge/spock-ibrar/results/copy.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/copy.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/copy.out	2025-12-04 16:02:53
@@ -1,106 +1,7 @@
 --test COPY
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-     CREATE TABLE public.x (
-	a serial primary key,
-	b int,
-	c text not null default 'stuff',
-	d text,
-	e text
-     );
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'x');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-COPY x (a, b, c, d, e) from stdin;
-COPY x (b, d) from stdin;
-COPY x (b, d) from stdin;
-COPY x (a, b, c, d, e) from stdin;
-SELECT * FROM x ORDER BY a;
-   a   | b  |   c   |    d    | e  
--------+----+-------+---------+----
-     1 |  1 | stuff | test_1  | 
-     2 |  2 | stuff | test_2  | 
-     3 |  3 | stuff | test_3  | 
-     4 |  4 | stuff | test_4  | 
-     5 |  5 | stuff | test_5  | 
-     6 |  6 | stuff | test_6  | 
-     7 |  7 | stuff | test_7  | 
-     8 |  8 | stuff | test_8  | 
-     9 |  9 | stuff | test_9  | 
-    10 | 10 | stuff | test_10 | 
-    11 | 11 | stuff | test_11 | 
-    12 | 12 | stuff | test_12 | 
-    13 | 13 | stuff | test_13 | 
-    14 | 14 | stuff | test_14 | 
-    15 | 15 | stuff | test_15 | 
-  9999 |    | \N    | NN      | 
- 10000 | 21 | 31    | 41      | 51
- 10001 | 22 | 32    | 42      | 52
- 10002 | 23 | 33    | 43      | 53
- 10003 | 24 | 34    | 44      | 54
- 10004 | 25 | 35    | 45      | 55
- 10005 | 26 | 36    | 46      | 56
-(22 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM x ORDER BY a;
-   a   | b  |   c   |    d    | e  
--------+----+-------+---------+----
-     1 |  1 | stuff | test_1  | 
-     2 |  2 | stuff | test_2  | 
-     3 |  3 | stuff | test_3  | 
-     4 |  4 | stuff | test_4  | 
-     5 |  5 | stuff | test_5  | 
-     6 |  6 | stuff | test_6  | 
-     7 |  7 | stuff | test_7  | 
-     8 |  8 | stuff | test_8  | 
-     9 |  9 | stuff | test_9  | 
-    10 | 10 | stuff | test_10 | 
-    11 | 11 | stuff | test_11 | 
-    12 | 12 | stuff | test_12 | 
-    13 | 13 | stuff | test_13 | 
-    14 | 14 | stuff | test_14 | 
-    15 | 15 | stuff | test_15 | 
-  9999 |    | \N    | NN      | 
- 10000 | 21 | 31    | 41      | 51
- 10001 | 22 | 32    | 42      | 52
- 10002 | 23 | 33    | 43      | 53
- 10003 | 24 | 34    | 44      | 54
- 10004 | 25 | 35    | 45      | 55
- 10005 | 26 | 36    | 46      | 56
-(22 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.x CASCADE;
-$$);
-NOTICE:  drop cascades to table x membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/sequence.out /Users/pgedge/pgedge/spock-ibrar/results/sequence.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/sequence.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/sequence.out	2025-12-04 16:02:53
@@ -17,29 +17,26 @@
 -- Replicate one sequence.
 CREATE SEQUENCE stress;
 SELECT * FROM spock.repset_create('stress_seq');
- repset_create 
----------------
-    3919156387
-(1 row)
-
+ERROR:  function spock.repset_create(unknown) does not exist
+LINE 1: SELECT * FROM spock.repset_create('stress_seq');
+                      ^
+HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
 SELECT * FROM spock.repset_add_seq('stress_seq', 'stress');
- repset_add_seq 
-----------------
- t
-(1 row)
-
+ERROR:  function spock.repset_add_seq(unknown, unknown) does not exist
+LINE 1: SELECT * FROM spock.repset_add_seq('stress_seq', 'stress');
+                      ^
+HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
 SELECT spock.sync_seq('stress');
- sync_seq 
-----------
- t
-(1 row)
-
+ERROR:  function spock.sync_seq(unknown) does not exist
+LINE 1: SELECT spock.sync_seq('stress');
+               ^
+HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
 SELECT heapallindexed();
- heapallindexed 
-----------------
- 
-(1 row)
-
+ERROR:  relation "spock.sequence_state" does not exist
+LINE 1: count_seqscan := (SELECT count(*) FROM spock.sequence_state)
+                                               ^
+QUERY:  count_seqscan := (SELECT count(*) FROM spock.sequence_state)
+CONTEXT:  PL/pgSQL function heapallindexed() line 6 at assignment
 -- Sync it 400 times in one transaction, to cross a spock.sequence_state
 -- page boundary and get a non-HOT update.
 DO $$
@@ -49,9 +46,15 @@
   END LOOP;
 END;
 $$;
+ERROR:  function spock.sync_seq(unknown) does not exist
+LINE 1: SELECT spock.sync_seq('stress')
+               ^
+HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
+QUERY:  SELECT spock.sync_seq('stress')
+CONTEXT:  PL/pgSQL function inline_code_block line 4 at PERFORM
 SELECT heapallindexed();
- heapallindexed 
-----------------
- 
-(1 row)
-
+ERROR:  relation "spock.sequence_state" does not exist
+LINE 1: count_seqscan := (SELECT count(*) FROM spock.sequence_state)
+                                               ^
+QUERY:  count_seqscan := (SELECT count(*) FROM spock.sequence_state)
+CONTEXT:  PL/pgSQL function heapallindexed() line 6 at assignment
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/triggers.out /Users/pgedge/pgedge/spock-ibrar/results/triggers.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/triggers.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/triggers.out	2025-12-04 16:02:53
@@ -1,207 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.test_trg_data(id serial primary key, data text);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'test_trg_data');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-CREATE TABLE test_trg_hist(table_name text, action text, action_id serial, original_data text, new_data text);
-CREATE FUNCTION test_trg_data_hist_fn() RETURNS TRIGGER AS $$
-BEGIN
-    IF (TG_OP = 'UPDATE') THEN
-        INSERT INTO test_trg_hist (table_name,action,original_data,new_data)
-        VALUES (TG_TABLE_NAME::TEXT, substring(TG_OP,1,1), ROW(OLD.*), ROW(NEW.*));
-        RETURN NEW;
-    ELSIF (TG_OP = 'DELETE') THEN
-        INSERT INTO test_trg_hist (table_name,action,original_data)
-        VALUES (TG_TABLE_NAME::TEXT, substring(TG_OP,1,1), ROW(OLD.*));
-        RETURN OLD;
-    ELSIF (TG_OP = 'INSERT') THEN
-        INSERT INTO test_trg_hist (table_name,action,new_data)
-        VALUES (TG_TABLE_NAME::TEXT, substring(TG_OP,1,1), ROW(NEW.*));
-        RETURN NEW;
-    ELSE
-        RAISE WARNING 'Unknown action';
-        RETURN NULL;
-    END IF;
-END;
-$$ LANGUAGE plpgsql;
-CREATE TRIGGER test_trg_data_hist_trg
-AFTER INSERT OR UPDATE OR DELETE ON test_trg_data
-FOR EACH ROW EXECUTE PROCEDURE test_trg_data_hist_fn();
-\c :provider_dsn
-INSERT INTO test_trg_data(data) VALUES ('no_history');
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM test_trg_data;
- id |    data    
-----+------------
-  1 | no_history
-(1 row)
-
-SELECT * FROM test_trg_hist;
- table_name | action | action_id | original_data | new_data 
-------------+--------+-----------+---------------+----------
-(0 rows)
-
-ALTER TABLE test_trg_data ENABLE REPLICA TRIGGER test_trg_data_hist_trg;
-\c :provider_dsn
-INSERT INTO test_trg_data(data) VALUES ('yes_history');
-UPDATE test_trg_data SET data = 'yes_history';
-DELETE FROM test_trg_data;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM test_trg_data;
- id | data 
-----+------
-(0 rows)
-
-SELECT * FROM test_trg_hist;
-  table_name   | action | action_id |  original_data  |    new_data     
----------------+--------+-----------+-----------------+-----------------
- test_trg_data | I      |         1 |                 | (2,yes_history)
- test_trg_data | U      |         2 | (1,no_history)  | (1,yes_history)
- test_trg_data | U      |         3 | (2,yes_history) | (2,yes_history)
- test_trg_data | D      |         4 | (1,yes_history) | 
- test_trg_data | D      |         5 | (2,yes_history) | 
-(5 rows)
-
-DROP TABLE test_trg_hist CASCADE;
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-        CREATE TABLE public.basic_dml (
-                id serial primary key,
-                other integer,
-                data text,
-                something interval
-        );
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- create row filter trigger
-CREATE FUNCTION filter_basic_dml_fn() RETURNS TRIGGER AS $$
-BEGIN
-    IF (TG_OP in ('UPDATE', 'INSERT')) THEN
--- treating 'DELETE' as pass-through
-        IF (NEW.id > 1 AND NEW.data IS DISTINCT FROM 'baz' AND NEW.data IS DISTINCT FROM 'bbb') THEN
-            RETURN NEW;
-        ELSE
-            RETURN NULL;
-        END IF;
-    ELSE
-        RAISE WARNING 'Unknown action';
-        RETURN NULL;
-    END IF;
-END;
-$$ LANGUAGE plpgsql;
-CREATE TRIGGER filter_basic_dml_trg
-BEFORE INSERT OR UPDATE ON basic_dml
-FOR EACH ROW EXECUTE PROCEDURE filter_basic_dml_fn();
-\c :provider_dsn
--- insert into table at provider
-\COPY basic_dml FROM STDIN WITH CSV
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- rows received at suscriber as trigger is not enabled yet.
-SELECT * from basic_dml ORDER BY id;
-  id  | other | data | something 
-------+-------+------+-----------
- 5000 |     1 | aaa  | @ 1 hour
- 5001 |     2 | bbb  | @ 2 years
- 5002 |     3 | ccc  | @ 3 mins
- 5003 |     4 | ddd  | @ 4 days
-(4 rows)
-
--- Now enable trigger:
-ALTER TABLE basic_dml ENABLE REPLICA TRIGGER filter_basic_dml_trg;
-\c :provider_dsn
-TRUNCATE basic_dml;
--- check basic insert replication
-INSERT INTO basic_dml(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- rows filtered at suscriber as trigger is enabled.
-SELECT * from basic_dml ORDER BY id;
- id | other | data |    something    
-----+-------+------+-----------------
-  2 |     4 | bar  | @ 84 days
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(3 rows)
-
-\set VERBOSITY terse
-DROP FUNCTION test_trg_data_hist_fn() CASCADE;
-NOTICE:  drop cascades to trigger test_trg_data_hist_trg on table test_trg_data
-DROP FUNCTION filter_basic_dml_fn() CASCADE;
-NOTICE:  drop cascades to trigger filter_basic_dml_trg on table basic_dml
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.test_trg_data CASCADE;
-	DROP TABLE public.basic_dml CASCADE;
-$$);
-NOTICE:  drop cascades to table test_trg_data membership in replication set default
-NOTICE:  drop cascades to table basic_dml membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/parallel.out /Users/pgedge/pgedge/spock-ibrar/results/parallel.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/parallel.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/parallel.out	2025-12-04 16:02:53
@@ -1,188 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT * FROM spock.repset_create('parallel');
- repset_create 
----------------
-    3827306560
-(1 row)
-
-\c :subscriber_dsn
--- FIXME: The statment below is commented out temporarily.
--- SELECT * FROM spock.sub_create(
---     subscription_name := 'test_subscription_parallel',
---     provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super',
--- 	replication_sets := '{parallel,default}',
--- 	forward_origins := '{}',
--- 	synchronize_structure := false,
--- 	synchronize_data := false
--- );
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription_parallel',
-    provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super',
-	replication_sets := '{parallel}',
-	forward_origins := '{}',
-	synchronize_structure := false,
-	synchronize_data := false
-);
- sub_create 
-------------
-          2
-(1 row)
-
-BEGIN;
-SET LOCAL statement_timeout = '10s';
-SELECT spock.sub_wait_for_sync('test_subscription_parallel');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-SELECT sync_kind, sync_subid, sync_nspname, sync_relname, sync_status IN ('y', 'r') FROM spock.local_sync_status ORDER BY 2,3,4;
- sync_kind | sync_subid | sync_nspname | sync_relname | ?column? 
------------+------------+--------------+--------------+----------
- f         |          1 |              |              | t
- i         |          2 |              |              | t
-(2 rows)
-
-SELECT * FROM spock.sub_show_status();
-     subscription_name      |   status    | provider_node |         provider_dsn         |                 slot_name                  |           replication_sets            | forward_origins 
-----------------------------+-------------+---------------+------------------------------+--------------------------------------------+---------------------------------------+-----------------
- test_subscription          | replicating | test_provider | dbname=regression user=super | spk_postgres_test_provider_test_sube55bf37 | {default,default_insert_only,ddl_sql} | 
- test_subscription_parallel | replicating | test_provider | dbname=regression user=super | spk_postgres_test_provider_test_subf1783d2 | {parallel}                            | 
-(2 rows)
-
--- Make sure we see the slot and active connection
-\c :provider_dsn
-SELECT plugin, slot_type, database, active FROM pg_replication_slots;
-    plugin    | slot_type |  database  | active 
---------------+-----------+------------+--------
- spock_output | logical   | regression | t
- spock_output | logical   | regression | t
-(2 rows)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     2
-(1 row)
-
-SELECT spock.replicate_ddl($$
-    CREATE TABLE public.basic_dml1 (
-        id serial primary key,
-        other integer,
-        data text,
-        something interval
-    );
-    CREATE TABLE public.basic_dml2 (
-        id serial primary key,
-        other integer,
-        data text,
-        something interval
-    );
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml1');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('parallel', 'basic_dml2');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-WITH one AS (
-INSERT INTO basic_dml1(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL)
-RETURNING *
-)
-INSERT INTO basic_dml2 SELECT * FROM one;
-BEGIN;
-UPDATE basic_dml1 SET other = id, something = something - '10 seconds'::interval WHERE id < 3;
-DELETE FROM basic_dml2 WHERE id < 3;
-COMMIT;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT * FROM basic_dml1;
- id | other | data |     something      
-----+-------+------+--------------------
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-  1 |     1 | foo  | @ 50 secs
-  2 |     2 | bar  | @ 84 days -10 secs
-(5 rows)
-
-SELECT * FROM basic_dml2;
- id | other | data |    something     
-----+-------+------+------------------
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(3 rows)
-
-\c :subscriber_dsn
-SELECT * FROM basic_dml1;
- id | other | data |     something      
-----+-------+------+--------------------
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-  1 |     1 | foo  | @ 50 secs
-  2 |     2 | bar  | @ 84 days -10 secs
-(5 rows)
-
-SELECT * FROM basic_dml2;
- id | other | data |    something     
-----+-------+------+------------------
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(3 rows)
-
-SELECT spock.sub_drop('test_subscription_parallel');
- sub_drop 
-----------
-        1
-(1 row)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT * FROM spock.repset_drop('parallel');
- repset_drop 
--------------
- t
-(1 row)
-
-SELECT spock.replicate_ddl($$
-    DROP TABLE public.basic_dml1 CASCADE;
-    DROP TABLE public.basic_dml2 CASCADE;
-$$);
-NOTICE:  drop cascades to table basic_dml1 membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/functions_1.out /Users/pgedge/pgedge/spock-ibrar/results/functions.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/functions_1.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/functions.out	2025-12-04 16:02:53
@@ -1,447 +1,7 @@
 --Immutable, volatile functions and nextval in DEFAULT clause
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE FUNCTION public.add(integer, integer) RETURNS integer
-    AS 'select $1 + $2;'
-    LANGUAGE SQL
-    IMMUTABLE
-    RETURNS NULL ON NULL INPUT;
-
-CREATE TABLE public.funct2(
-	a integer,
-	b integer,
-	c integer DEFAULT public.add(10,12 )
-) ;
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default_insert_only', 'public.funct2');
- repset_add_table 
----------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO public.funct2(a,b) VALUES (1,2);--c should be 22
-INSERT INTO public.funct2(a,b,c) VALUES (3,4,5);-- c should be 5
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * from public.funct2;
- a | b | c  
----+---+----
- 1 | 2 | 22
- 3 | 4 |  5
-(2 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-create or replace function public.get_curr_century() returns double precision as
- 'SELECT EXTRACT(CENTURY FROM NOW());'
-language sql volatile;
-
-CREATE TABLE public.funct5(
-	a integer,
-	b integer,
-	c double precision DEFAULT public.get_curr_century()
-);
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_all_tables('default_insert_only', '{public}');
- repset_add_all_tables 
---------------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO public.funct5(a,b) VALUES (1,2);--c should be e.g. 21 for 2015
-INSERT INTO public.funct5(a,b,c) VALUES (3,4,20);-- c should be 20
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * from public.funct5;
- a | b | c  
----+---+----
- 1 | 2 | 21
- 3 | 4 | 20
-(2 rows)
-
---nextval check
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE SEQUENCE public.INSERT_SEQ;
-
-CREATE TABLE public.funct (
-	a integer,
-	b INT DEFAULT nextval('public.insert_seq')
-);
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_all_tables('default_insert_only', '{public}');
- repset_add_all_tables 
---------------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO public.funct (a) VALUES (1);
-INSERT INTO public.funct (a) VALUES (2);
-INSERT INTO public.funct (a) VALUES (3);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.funct;
- a | b 
----+---
- 1 | 1
- 2 | 2
- 3 | 3
-(3 rows)
-
-\c :provider_dsn
-BEGIN;
-COMMIT;--empty transaction
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.funct;
- a | b 
----+---
- 1 | 1
- 2 | 2
- 3 | 3
-(3 rows)
-
--- test replication where the destination table has extra (nullable) columns that are not in the origin table
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.nullcheck_tbl(
-	id integer PRIMARY KEY,
-	id1 integer,
-	name text
-) ;
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'nullcheck_tbl');
- repset_add_table 
----------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO public.nullcheck_tbl(id,id1,name) VALUES (1,1,'name1');
-INSERT INTO public.nullcheck_tbl(id,id1,name) VALUES (2,2,'name2');
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.nullcheck_tbl;
- id | id1 | name  
-----+-----+-------
-  1 |   1 | name1
-  2 |   2 | name2
-(2 rows)
-
-ALTER TABLE public.nullcheck_tbl ADD COLUMN name1 text;
-SELECT * FROM public.nullcheck_tbl;
- id | id1 | name  | name1 
-----+-----+-------+-------
-  1 |   1 | name1 | 
-  2 |   2 | name2 | 
-(2 rows)
-
-\c :provider_dsn
-INSERT INTO public.nullcheck_tbl(id,id1,name) VALUES (3,3,'name3');
-INSERT INTO public.nullcheck_tbl(id,id1,name) VALUES (4,4,'name4');
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.nullcheck_tbl;
- id | id1 | name  | name1 
-----+-----+-------+-------
-  1 |   1 | name1 | 
-  2 |   2 | name2 | 
-  3 |   3 | name3 | 
-  4 |   4 | name4 | 
-(4 rows)
-
-\c :provider_dsn
-UPDATE public.nullcheck_tbl SET name='name31' where id = 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-INSERT INTO public.nullcheck_tbl(id,id1,name) VALUES (6,6,'name6');
-SELECT * FROM public.nullcheck_tbl;
- id | id1 |  name  | name1 
-----+-----+--------+-------
-  1 |   1 | name1  | 
-  2 |   2 | name2  | 
-  4 |   4 | name4  | 
-  3 |   3 | name31 | 
-  6 |   6 | name6  | 
-(5 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE TABLE public.not_nullcheck_tbl(
-	id integer PRIMARY KEY,
-	id1 integer,
-	name text
-) ;
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'not_nullcheck_tbl');
- repset_add_table 
----------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-ALTER TABLE public.not_nullcheck_tbl ADD COLUMN id2 integer not null;
-\c :provider_dsn
-SELECT quote_literal(pg_current_xlog_location()) as curr_lsn
-\gset
-INSERT INTO public.not_nullcheck_tbl(id,id1,name) VALUES (1,1,'name1');
-INSERT INTO public.not_nullcheck_tbl(id,id1,name) VALUES (2,2,'name2');
-SELECT spock.wait_slot_confirm_lsn(NULL, :curr_lsn);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.not_nullcheck_tbl;
- id | id1 | name | id2 
-----+-----+------+-----
-(0 rows)
-
-INSERT INTO public.not_nullcheck_tbl(id,id1,name) VALUES (3,3,'name3');
-ERROR:  null value in column "id2" of relation "not_nullcheck_tbl" violates not-null constraint
-DETAIL:  Failing row contains (3, 3, name3, null).
-SELECT * FROM public.not_nullcheck_tbl;
- id | id1 | name | id2 
-----+-----+------+-----
-(0 rows)
-
-SELECT spock.alter_subscription_disable('test_subscription', true);
- alter_subscription_disable 
-----------------------------
- t
-(1 row)
-
-\c :provider_dsn
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF (SELECT count(1) FROM pg_replication_slots WHERE active = false) THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-SELECT data::json->'action' as action, CASE WHEN data::json->>'action' IN ('I', 'D', 'U') THEN data END as data FROM pg_logical_slot_get_changes((SELECT slot_name FROM pg_replication_slots), NULL, 1, 'min_proto_version', '1', 'max_proto_version', '1', 'startup_params_format', '1', 'proto_format', 'json', 'spock.replication_set_names', 'default');
- action |                                                data                                                 
---------+-----------------------------------------------------------------------------------------------------
- "S"    | 
- "B"    | 
- "I"    | {"action":"I","relation":["public","not_nullcheck_tbl"],"newtuple":{"id":1,"id1":1,"name":"name1"}}
- "C"    | 
-(4 rows)
-
-SELECT data::json->'action' as action, CASE WHEN data::json->>'action' IN ('I', 'D', 'U') THEN data END as data FROM pg_logical_slot_get_changes((SELECT slot_name FROM pg_replication_slots), NULL, 1, 'min_proto_version', '1', 'max_proto_version', '1', 'startup_params_format', '1', 'proto_format', 'json', 'spock.replication_set_names', 'default');
- action |                                                data                                                 
---------+-----------------------------------------------------------------------------------------------------
- "S"    | 
- "B"    | 
- "I"    | {"action":"I","relation":["public","not_nullcheck_tbl"],"newtuple":{"id":2,"id1":2,"name":"name2"}}
- "C"    | 
-(4 rows)
-
-\c :subscriber_dsn
-SELECT spock.alter_subscription_enable('test_subscription', true);
- alter_subscription_enable 
----------------------------
- t
-(1 row)
-
-ALTER TABLE public.not_nullcheck_tbl ALTER COLUMN id2 SET default 99;
-\c :provider_dsn
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF (SELECT count(1) FROM pg_replication_slots WHERE active = true) THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-INSERT INTO public.not_nullcheck_tbl(id,id1,name) VALUES (4,4,'name4'); -- id2 will be 99 on subscriber
-ALTER TABLE public.not_nullcheck_tbl ADD COLUMN id2 integer not null default 0;
-INSERT INTO public.not_nullcheck_tbl(id,id1,name) VALUES (5,5,'name5'); -- id2 will be 0 on both
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM public.not_nullcheck_tbl;
- id | id1 | name  | id2 
-----+-----+-------+-----
-  4 |   4 | name4 |  99
-  5 |   5 | name5 |   0
-(2 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-CREATE FUNCTION public.some_prime_numbers() RETURNS SETOF integer
-	LANGUAGE sql IMMUTABLE STRICT LEAKPROOF
-	AS $_$
-  VALUES (2), (3), (5), (7), (11), (13), (17), (19), (23), (29), (31), (37), (41), (43), (47), (53), (59), (61), (67), (71), (73), (79), (83), (89), (97)
-$_$;
-
-CREATE FUNCTION public.is_prime_lt_100(integer) RETURNS boolean
-    LANGUAGE sql IMMUTABLE STRICT LEAKPROOF
-	AS $_$
-  SELECT EXISTS (SELECT FROM public.some_prime_numbers() s(p) WHERE p = $1)
-$_$;
-
-CREATE DOMAIN public.prime AS integer
-CONSTRAINT prime_check CHECK(public.is_prime_lt_100(VALUE));
-
-CREATE TABLE public.prime_tbl (
-	num public.prime NOT NULL,
-	PRIMARY KEY(num)
-);
-
-INSERT INTO public.prime_tbl (num) VALUES(17), (31), (79);
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'public.prime_tbl');
- repset_add_table 
----------------------------
- t
-(1 row)
-
-DELETE FROM public.prime_tbl WHERE num = 31;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT num FROM public.prime_tbl;
- num 
------
-  17
-  79
-(2 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.funct CASCADE;
-	DROP SEQUENCE public.INSERT_SEQ;
-	DROP TABLE public.funct2 CASCADE;
-	DROP TABLE public.funct5 CASCADE;
-	DROP FUNCTION public.get_curr_century();
-	DROP FUNCTION public.add(integer, integer);
-	DROP TABLE public.nullcheck_tbl CASCADE;
-	DROP TABLE public.not_nullcheck_tbl CASCADE;
-	DROP TABLE public.prime_tbl CASCADE;
-	DROP DOMAIN public.prime;
-	DROP FUNCTION public.is_prime_lt_100(integer);
-	DROP FUNCTION public.some_prime_numbers();
-$$);
-NOTICE:  drop cascades to table funct membership in replication set default_insert_only
-NOTICE:  drop cascades to table funct2 membership in replication set default_insert_only
-NOTICE:  drop cascades to table funct5 membership in replication set default_insert_only
-NOTICE:  drop cascades to table nullcheck_tbl membership in replication set default
-NOTICE:  drop cascades to table not_nullcheck_tbl membership in replication set default
-NOTICE:  drop cascades to table prime_tbl membership in replication set default
- replicate_ddl 
------------------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/row_filter_2.out /Users/pgedge/pgedge/spock-ibrar/results/row_filter.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/row_filter_2.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/row_filter.out	2025-12-04 16:02:53
@@ -3,710 +3,7 @@
 -- checking that Spock does for Postgres 18 and above
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = true;
-ALTER SYSTEM SET spock.exception_behaviour = discard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = true;
-ALTER SYSTEM SET spock.exception_behaviour = discard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.basic_dml (
-		id serial primary key,
-		other integer,
-		data text,
-		"SomeThing" interval,
-		insert_xid bigint DEFAULT txid_current()
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
--- used to check if initial copy does row filtering
-\COPY basic_dml(id, other, data, "SomeThing") FROM STDIN WITH CSV
--- create some functions:
-CREATE FUNCTION funcn_add(integer, integer) RETURNS integer
-    AS 'select $1 + $2;'
-    LANGUAGE SQL
-    IMMUTABLE
-    RETURNS NULL ON NULL INPUT;
-create function funcn_nochange(text) returns text
-  as 'select $1 limit 1' language sql stable;
-create or replace function funcn_get_curr_decade() returns integer as
-$$ (SELECT EXTRACT(DECADE FROM NOW()):: integer); $$
-language sql volatile;
--- we allow volatile functions, it's user's responsibility to not do writes
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := 'current_user = data');
-ERROR:  invalid publication WHERE expression
-DETAIL:  Only columns, constants, built-in operators, built-in data types, built-in collations, and immutable built-in functions are allowed.
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
--- fail -- subselect
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := '(SELECT count(*) FROM pg_class) > 1');
-ERROR:  cannot use subquery in check constraint
--- fail -- SELECT
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := 'SELECT true');
-ERROR:  syntax error at or near "SELECT"
-CONTEXT:  invalid row_filter expression "SELECT true"
--- fail -- nonexisting column
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := 'foobar');
-ERROR:  column "foobar" does not exist
--- fail -- not coercable to bool
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := 'data');
-ERROR:  argument of row_filter must be type boolean, not type text
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := $rf$id between 2 AND 4$rf$);
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := NULL);
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := $rf$id > funcn_add(1,2) $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := $rf$data = funcn_nochange('baz') $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, row_filter := $rf$ other > funcn_get_curr_decade()  $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
--- use this filter for rest of the test
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', true, row_filter := $rf$id > 1 AND data IS DISTINCT FROM 'baz' AND data IS DISTINCT FROM 'bbb'$rf$);
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables WHERE relname = 'basic_dml';
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
--- fail, the membership in repset depends on data column
-\set VERBOSITY terse
-ALTER TABLE basic_dml DROP COLUMN data;
-ERROR:  cannot drop column data of table basic_dml because other objects depend on it
-\set VERBOSITY default
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- wait for the initial data to copy
-BEGIN;
-SET LOCAL statement_timeout = '60s';
-SELECT spock.sub_wait_for_sync('test_subscription');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
-  id  | other | data | SomeThing 
-------+-------+------+-----------
- 5000 |     1 | aaa  | @ 1 hour
- 5002 |     3 | ccc  | @ 3 mins
- 5003 |     4 | ddd  | @ 4 days
-(3 rows)
-
-ALTER TABLE public.basic_dml ADD COLUMN subonly integer;
-ALTER TABLE public.basic_dml ADD COLUMN subonly_def integer DEFAULT 99;
-ALTER TABLE public.basic_dml ADD COLUMN subonly_def_ts timestamptz DEFAULT current_timestamp;
-\c :provider_dsn
-TRUNCATE basic_dml;
--- check basic insert replication
-INSERT INTO basic_dml(other, data, "SomeThing")
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data |    SomeThing    
-----+-------+------+-----------------
-  2 |     4 | bar  | @ 84 days
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(3 rows)
-
--- update one row
-\c :provider_dsn
-UPDATE basic_dml SET other = '4', data = NULL, "SomeThing" = '3 days'::interval WHERE id = 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data | SomeThing 
-----+-------+------+-----------
-  2 |     4 | bar  | @ 84 days
-  4 |     4 |      | @ 3 days
-  5 |     1 |      | 
-(3 rows)
-
--- update multiple rows
-\c :provider_dsn
-UPDATE basic_dml SET other = id, data = data || id::text;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data | SomeThing 
-----+-------+------+-----------
-  2 |     2 | bar2 | @ 84 days
-  4 |     4 |      | @ 3 days
-  5 |     5 |      | 
-(3 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET other = id, "SomeThing" = "SomeThing" - '10 seconds'::interval WHERE id < 3;
-UPDATE basic_dml SET other = id, "SomeThing" = "SomeThing" + '10 seconds'::interval WHERE id > 3;
-DELETE FROM basic_dml WHERE id = 3;
-INSERT INTO basic_dml VALUES (3, 99, 'bazbaz', '2 years 1 hour'::interval);
-INSERT INTO basic_dml VALUES (7, 100, 'bazbaz', '2 years 1 hour'::interval);
-UPDATE basic_dml SET data = 'baz' WHERE id in (3,7);
--- This update would be filtered at subscriber
-SELECT id, other, data, "SomeThing" from basic_dml ORDER BY id;
- id | other | data |     SomeThing      
-----+-------+------+--------------------
-  1 |     1 | foo1 | @ 50 secs
-  2 |     2 | bar2 | @ 84 days -10 secs
-  3 |    99 | baz  | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-  7 |   100 | baz  | @ 2 years 1 hour
-(6 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing", subonly, subonly_def FROM basic_dml ORDER BY id;
- id | other |  data  |     SomeThing      | subonly | subonly_def 
-----+-------+--------+--------------------+---------+-------------
-  2 |     2 | bar2   | @ 84 days -10 secs |         |          99
-  3 |    99 | bazbaz | @ 2 years 1 hour   |         |          99
-  4 |     4 |        | @ 3 days 10 secs   |         |          99
-  5 |     5 |        |                    |         |          99
-  7 |   100 | bazbaz | @ 2 years 1 hour   |         |          99
-(5 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET data = 'bar' WHERE id = 3;
--- This update would again start to be received at subscriber
-DELETE FROM basic_dml WHERE data = 'baz';
--- Delete reaches the subscriber for a filtered row
-INSERT INTO basic_dml VALUES (6, 100, 'baz', '2 years 1 hour'::interval);
--- insert would be filtered
-SELECT id, other, data, "SomeThing" from basic_dml ORDER BY id;
- id | other | data |     SomeThing      
-----+-------+------+--------------------
-  1 |     1 | foo1 | @ 50 secs
-  2 |     2 | bar2 | @ 84 days -10 secs
-  3 |    99 | bar  | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-  6 |   100 | baz  | @ 2 years 1 hour
-(6 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing", subonly, subonly_def FROM basic_dml ORDER BY id;
- id | other | data |     SomeThing      | subonly | subonly_def 
-----+-------+------+--------------------+---------+-------------
-  2 |     2 | bar2 | @ 84 days -10 secs |         |          99
-  3 |    99 | bar  | @ 2 years 1 hour   |         |          99
-  4 |     4 |      | @ 3 days 10 secs   |         |          99
-  5 |     5 |      |                    |         |          99
-(4 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET data = 'bar' WHERE id = 6;
-UPDATE basic_dml SET data = 'abcd' WHERE id = 6;
--- These updates would continue to be missed on subscriber
--- as it does not have the primary key
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data |     SomeThing      
-----+-------+------+--------------------
-  2 |     2 | bar2 | @ 84 days -10 secs
-  3 |    99 | bar  | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-(4 rows)
-
--- transaction timestamp should be updated for each row (see #148)
-SELECT count(DISTINCT subonly_def_ts) = count(DISTINCT insert_xid) FROM basic_dml;
- ?column? 
-----------
- t
-(1 row)
-
--- delete multiple rows
-\c :provider_dsn
-DELETE FROM basic_dml WHERE id < 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data |    SomeThing     
-----+-------+------+------------------
-  4 |     4 |      | @ 3 days 10 secs
-  5 |     5 |      | 
-(2 rows)
-
--- truncate
-\c :provider_dsn
-TRUNCATE basic_dml;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
- id | other | data | SomeThing 
-----+-------+------+-----------
-(0 rows)
-
--- copy
-\c :provider_dsn
-\COPY basic_dml(id, other, data, "SomeThing") FROM STDIN WITH CSV
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, "SomeThing" FROM basic_dml ORDER BY id;
-  id  | other | data | SomeThing 
-------+-------+------+-----------
- 9000 |     1 | aaa  | @ 1 hour
- 9002 |     3 | ccc  | @ 3 mins
- 9003 |     4 | ddd  | @ 4 days
-(3 rows)
-
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.test_jsonb (
-		json_type text primary key,
-		test_json jsonb
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-INSERT INTO test_jsonb VALUES
-('scalar','"a scalar"'),
-('array','["zero", "one","two",null,"four","five", [1,2,3],{"f1":9}]'),
-('object','{"field1":"val1","field2":"val2","field3":null, "field4": 4, "field5": [1,2,3], "field6": {"f1":9}}');
-SELECT * FROM spock.repset_add_table('default', 'test_jsonb', true, row_filter := $rf$(test_json ->> 'field2') IS DISTINCT FROM 'val2' $rf$);
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-DO $$
-BEGIN
-    FOR i IN 1..100 LOOP
-        IF NOT EXISTS (SELECT 1 FROM spock.local_sync_status WHERE sync_status != 'r') THEN
-            EXIT;
-        END IF;
-        PERFORM pg_sleep(0.1);
-    END LOOP;
-END;$$;
-SELECT * FROM test_jsonb ORDER BY json_type;
- json_type |                             test_json                              
------------+--------------------------------------------------------------------
- array     | ["zero", "one", "two", null, "four", "five", [1, 2, 3], {"f1": 9}]
- scalar    | "a scalar"
-(2 rows)
-
-\c :provider_dsn
--- Filter may refer to not-replicated columns
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false, columns := ARRAY['id', 'data'], row_filter := $rf$other = 2$rf$);
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO basic_dml(other, data, "SomeThing") VALUES (2, 'itstwo', '1 second'::interval);
-SELECT other, data, "SomeThing" FROM basic_dml WHERE data = 'itstwo';
- other |  data  | SomeThing 
--------+--------+-----------
-     2 | itstwo | @ 1 sec
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- 'other' will be NULL as it wasn't in the repset
--- even though we filtered on it. So will SomeThing.
-SELECT other, data, "SomeThing" FROM basic_dml WHERE data = 'itstwo';
- other |  data  | SomeThing 
--------+--------+-----------
-       | itstwo | 
-(1 row)
-
-\c :provider_dsn
----------------------------------------------------
--- Enhanced function tests covering basic plpgsql
----------------------------------------------------
-CREATE FUNCTION func_plpgsql_simple(arg integer)
-RETURNS integer
-LANGUAGE plpgsql
-AS $$
-BEGIN
-  RETURN arg;
-END;
-$$;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ func_plpgsql_simple(other) = 100 $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
--- Should FAIL due to dependency
---
--- FIXME: Succeeds incorrectly (RM#5880) leading to
---     cache lookup failed for function" errors in logs if allowed to commit
---
-BEGIN;
-DROP FUNCTION func_plpgsql_simple(integer);
-ROLLBACK;
-INSERT INTO basic_dml (other) VALUES (100), (101);
-SELECT other FROM basic_dml WHERE other IN (100,101);
- other 
--------
-   100
-   101
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT other FROM basic_dml WHERE other IN (100,101);
- other 
--------
-(0 rows)
-
-\c :provider_dsn
-CREATE FUNCTION func_plpgsql_logic(arg integer)
-RETURNS integer
-LANGUAGE plpgsql
-AS $$
-BEGIN
-  IF arg = 200 THEN
-    RETURN arg;
-  ELSE
-    RETURN 0;
-  END IF;
-END;
-$$;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ func_plpgsql_logic(other) = other $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-INSERT INTO basic_dml (other) VALUES (200), (201);
-SELECT other FROM basic_dml WHERE other IN (200,201);
- other 
--------
-   200
-   201
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT other FROM basic_dml WHERE other IN (200,201);
- other 
--------
-(0 rows)
-
-\c :provider_dsn
-CREATE FUNCTION func_plpgsql_security_definer(arg integer)
-RETURNS integer
-LANGUAGE plpgsql
-SECURITY DEFINER
-AS $$
-BEGIN
-  RAISE NOTICE 'c_u: %, s_u: %', current_user, session_user;
-  RETURN arg;
-END;
-$$;
-CREATE ROLE temp_owner;
-ALTER FUNCTION func_plpgsql_security_definer(integer) OWNER TO temp_owner;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ func_plpgsql_security_definer(other) = 300 $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-INSERT INTO basic_dml (other) VALUES (300), (301);
-SELECT other FROM basic_dml WHERE other IN (300,301);
- other 
--------
-   300
-   301
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT other FROM basic_dml WHERE other IN (300,301);
- other 
--------
-(0 rows)
-
-\c :provider_dsn
-CREATE FUNCTION func_plpgsql_exception(arg integer)
-RETURNS integer
-LANGUAGE plpgsql
-AS $$
-BEGIN
-  BEGIN
-    SELECT arg/0;
-  EXCEPTION
-    WHEN division_by_zero THEN
-      RETURN arg;
-  END;
-  RAISE EXCEPTION 'should be unreachable';
-END;
-$$;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ func_plpgsql_exception(other) = 400 $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-INSERT INTO basic_dml (other) VALUES (400), (401);
-SELECT other FROM basic_dml WHERE other IN (400,401);
- other 
--------
-   400
-   401
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT other FROM basic_dml WHERE other IN (400,401);
- other 
--------
-(0 rows)
-
-\c :provider_dsn
--- Should not be able to use a SETOF or TABLE func directly
--- but we can do it via a wrapper:
-CREATE FUNCTION func_plpgsql_srf_retq(arg integer)
-RETURNS TABLE (result integer, dummy boolean)
-LANGUAGE plpgsql
-SECURITY DEFINER
-AS $$
-BEGIN
-  RETURN QUERY SELECT arg * x, true FROM generate_series(1,2) x;
-  RETURN;
-END;
-$$;
--- fails with SRF context error
-BEGIN;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ (func_plpgsql_srf_retq(other)).result = 500 $rf$);
-ERROR:  current transaction is aborted, commands ignored until end of transaction block
-ROLLBACK;
-CREATE FUNCTION func_plpgsql_call_set(arg integer)
-RETURNS boolean
-LANGUAGE plpgsql
-AS $$
-BEGIN
-  RETURN (SELECT true FROM func_plpgsql_srf_retq(arg) WHERE result = arg * 2);
-END;
-$$;
-SELECT * FROM spock.repset_remove_table('default', 'basic_dml');
-ERROR:  Table basic_dml not found in replication set default
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', false,
-	row_filter := $rf$ func_plpgsql_call_set(other) $rf$);
-ERROR:  invalid publication WHERE expression
-DETAIL:  User-defined or built-in mutable functions are not allowed.
-INSERT INTO basic_dml (other) VALUES (500), (501);
-SELECT other FROM basic_dml WHERE other IN (500,501);
- other 
--------
-   500
-   501
-(2 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT other FROM basic_dml WHERE other IN (500,501);
- other 
--------
-(0 rows)
-
-\c :provider_dsn
-DROP FUNCTION func_plpgsql_simple(integer);
-DROP FUNCTION func_plpgsql_logic(integer);
-DROP FUNCTION func_plpgsql_security_definer(integer);
-DROP FUNCTION func_plpgsql_exception(integer);
-DROP FUNCTION func_plpgsql_srf_retq(integer);
-DROP FUNCTION func_plpgsql_call_set(integer);
-DROP ROLE temp_owner;
----------------------------------------------------
--- ^^^ End plpgsql tests
----------------------------------------------------
-\c :provider_dsn
-\set VERBOSITY terse
-DROP FUNCTION funcn_add(integer, integer);
-DROP FUNCTION funcn_nochange(text);
-DROP FUNCTION funcn_get_curr_decade();
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.basic_dml CASCADE;
-	DROP TABLE public.test_jsonb CASCADE;
-$$);
-NOTICE:  drop cascades to table test_jsonb membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-\c :provider_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = false;
-ALTER SYSTEM SET spock.exception_behaviour = transdiscard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-ALTER SYSTEM SET spock.check_all_uc_indexes = false;
-ALTER SYSTEM SET spock.exception_behaviour = transdiscard;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/row_filter_sampling_1.out /Users/pgedge/pgedge/spock-ibrar/results/row_filter_sampling.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/row_filter_sampling_1.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/row_filter_sampling.out	2025-12-04 16:02:53
@@ -1,8 +1,7 @@
 -- row based filtering
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
--- Do not run for Postgres 18 or higher
-SELECT current_setting('server_version_num') >= '180000' as is_pg18_or_higher \gset
-\if :is_pg18_or_higher
-	\q
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/att_list.out /Users/pgedge/pgedge/spock-ibrar/results/att_list.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/att_list.out	2025-11-20 18:20:49
+++ /Users/pgedge/pgedge/spock-ibrar/results/att_list.out	2025-12-04 16:02:53
@@ -1,314 +1,7 @@
 -- basic builtin datatypes
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-CREATE TABLE public.basic_dml (
-	id serial primary key,
-	other integer,
-	data text,
-	something interval
-);
--- fails as primary key is not included
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', columns := '{ data, something}');
-ERROR:  REPLICA IDENTITY columns must be replicated
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', columns := '{id, data, something}');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-CREATE TABLE public.basic_dml (
-	id serial primary key,
-	data text,
-	something interval,
-	subonly integer,
-	subonly_def integer DEFAULT 99
-);
-\c :provider_dsn
--- check basic insert replication
-INSERT INTO basic_dml(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  1 | foo  | @ 1 min
-  2 | bar  | @ 84 days
-  3 | baz  | @ 2 years 1 hour
-  4 | qux  | @ 8 mons 2 days
-  5 |      | 
-(5 rows)
-
--- update one row
-\c :provider_dsn
-UPDATE basic_dml SET other = '4', data = NULL, something = '3 days'::interval WHERE id = 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  1 | foo  | @ 1 min
-  2 | bar  | @ 84 days
-  3 | baz  | @ 2 years 1 hour
-  4 |      | @ 3 days
-  5 |      | 
-(5 rows)
-
--- update multiple rows
-\c :provider_dsn
-SELECT * FROM basic_dml order by id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days
-  5 |     1 |      | 
-(5 rows)
-
-UPDATE basic_dml SET data = data || other::text;
-SELECT * FROM basic_dml order by id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo5 | @ 1 min
-  2 |     4 | bar4 | @ 84 days
-  3 |     3 | baz3 | @ 2 years 1 hour
-  4 |     4 |      | @ 3 days
-  5 |     1 |      | 
-(5 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  1 | foo5 | @ 1 min
-  2 | bar4 | @ 84 days
-  3 | baz3 | @ 2 years 1 hour
-  4 |      | @ 3 days
-  5 |      | 
-(5 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET other = id, data = data || id::text;
-SELECT * FROM basic_dml order by id;
- id | other | data  |    something     
-----+-------+-------+------------------
-  1 |     1 | foo51 | @ 1 min
-  2 |     2 | bar42 | @ 84 days
-  3 |     3 | baz33 | @ 2 years 1 hour
-  4 |     4 |       | @ 3 days
-  5 |     5 |       | 
-(5 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data  |    something     
-----+-------+------------------
-  1 | foo51 | @ 1 min
-  2 | bar42 | @ 84 days
-  3 | baz33 | @ 2 years 1 hour
-  4 |       | @ 3 days
-  5 |       | 
-(5 rows)
-
-\c :provider_dsn
-UPDATE basic_dml SET other = id, something = something - '10 seconds'::interval WHERE id < 3;
-UPDATE basic_dml SET other = id, something = something + '10 seconds'::interval WHERE id > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something, subonly, subonly_def FROM basic_dml ORDER BY id;
- id | data  |     something      | subonly | subonly_def 
-----+-------+--------------------+---------+-------------
-  1 | foo51 | @ 50 secs          |         |          99
-  2 | bar42 | @ 84 days -10 secs |         |          99
-  3 | baz33 | @ 2 years 1 hour   |         |          99
-  4 |       | @ 3 days 10 secs   |         |          99
-  5 |       |                    |         |          99
-(5 rows)
-
--- delete one row
-\c :provider_dsn
-DELETE FROM basic_dml WHERE id = 2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data  |    something     
-----+-------+------------------
-  1 | foo51 | @ 50 secs
-  3 | baz33 | @ 2 years 1 hour
-  4 |       | @ 3 days 10 secs
-  5 |       | 
-(4 rows)
-
--- delete multiple rows
-\c :provider_dsn
-DELETE FROM basic_dml WHERE id < 4;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  4 |      | @ 3 days 10 secs
-  5 |      | 
-(2 rows)
-
--- truncate
-\c :provider_dsn
-TRUNCATE basic_dml;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data | something 
-----+------+-----------
-(0 rows)
-
--- copy
-\c :provider_dsn
-\COPY basic_dml FROM STDIN WITH CSV
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
-  id  | data | something 
-------+------+-----------
- 9000 | aaa  | @ 1 hour
- 9001 | bbb  | @ 2 years
- 9002 | ccc  | @ 3 mins
- 9003 | ddd  | @ 4 days
-(4 rows)
-
-\c :provider_dsn
--- drop columns being filtered at provider
--- even primary key can be dropped
-ALTER TABLE basic_dml DROP COLUMN id;
-ALTER TABLE basic_dml DROP COLUMN data;
-\c :subscriber_dsn
-SELECT id, data, something FROM basic_dml ORDER BY id;
-  id  | data | something 
-------+------+-----------
- 9000 | aaa  | @ 1 hour
- 9001 | bbb  | @ 2 years
- 9002 | ccc  | @ 3 mins
- 9003 | ddd  | @ 4 days
-(4 rows)
-
-\c :provider_dsn
--- add column to table at provider
-ALTER TABLE basic_dml ADD COLUMN data1 text;
-INSERT INTO basic_dml(other, data1, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval);
--- inserts after dropping primary key still reach the subscriber.
-UPDATE basic_dml set something = something - '10 seconds'::interval;
-DELETE FROM basic_dml WHERE other = 2;
-SELECT * FROM basic_dml ORDER BY other;
- other |     something      | data1 
--------+--------------------+-------
-     1 | @ 59 mins 50 secs  | 
-     3 | @ 2 mins 50 secs   | 
-     4 | @ 4 days -10 secs  | 
-     4 | @ 84 days -10 secs | bar
-     5 | @ 50 secs          | foo
-(5 rows)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml', ARRAY['default']);
- nspname |  relname  |  att_list   | has_row_filter 
----------+-----------+-------------+----------------
- public  | basic_dml | {something} | f
-(1 row)
-
--- Need to wait confirmation of flushing to the slot everything changed
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
--- verify that columns are not automatically added for filtering unless told so.
-SELECT * FROM spock.sub_show_table('test_subscription', 'basic_dml');
- nspname |  relname  | status  
----------+-----------+---------
- public  | basic_dml | unknown
-(1 row)
-
-SELECT * FROM basic_dml ORDER BY id;
-  id  | data | something | subonly | subonly_def 
-------+------+-----------+---------+-------------
-    1 |      | @ 1 min   |         |          99
-    2 |      | @ 84 days |         |          99
- 9000 | aaa  | @ 1 hour  |         |          99
- 9001 | bbb  | @ 2 years |         |          99
- 9002 | ccc  | @ 3 mins  |         |          99
- 9003 | ddd  | @ 4 days  |         |          99
-(6 rows)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.basic_dml CASCADE;
-$$);
-NOTICE:  drop cascades to table basic_dml membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/column_filter.out /Users/pgedge/pgedge/spock-ibrar/results/column_filter.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/column_filter.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/column_filter.out	2025-12-04 16:02:53
@@ -1,273 +1,8 @@
 -- basic builtin datatypes
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 -- create and populate table at provider
 \c :provider_dsn
-CREATE TABLE public.basic_dml (
-	id serial primary key,
-	other integer,
-	data text,
-	something interval
-);
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | 
-(1 row)
-
-INSERT INTO basic_dml(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-\c :subscriber_dsn
--- create table on subscriber to receive replicated filtered data from provider
--- there are some extra columns too, and we omit 'other' as a non-replicated
--- table on upstream only.
-CREATE TABLE public.basic_dml (
-	id serial primary key,
-	data text,
-	something interval,
-	subonly integer,
-	subonly_def integer DEFAULT 99
-);
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |                att_list                 | has_row_filter 
----------+-----------+-----------------------------------------+----------------
- public  | basic_dml | {id,data,something,subonly,subonly_def} | f
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | 
-(1 row)
-
-\c :provider_dsn
--- Fails: the column filter list must include the key
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', synchronize_data := true, columns := '{data, something}');
-ERROR:  REPLICA IDENTITY columns must be replicated
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | 
-(1 row)
-
--- Fails: the column filter list may not include cols that are not in the table
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', synchronize_data := true, columns := '{data, something, nosuchcol}');
-ERROR:  table public.basic_dml does not have column nosuchcol
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | 
-(1 row)
-
--- At provider, add table to replication set, with filtered columns
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', synchronize_data := true, columns := '{id, data, something}');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |      att_list       | has_row_filter 
----------+-----------+---------------------+----------------
- public  | basic_dml | {id,data,something} | f
-(1 row)
-
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  1 | foo  | @ 1 min
-  2 | bar  | @ 84 days
-  3 | baz  | @ 2 years 1 hour
-  4 | qux  | @ 8 mons 2 days
-  5 |      | 
-(5 rows)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-BEGIN;
-SET LOCAL statement_timeout = '20s';
-SELECT spock.table_wait_for_sync('test_subscription', 'basic_dml');
- table_wait_for_sync 
----------------------
- 
-(1 row)
-
-COMMIT;
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |                att_list                 | has_row_filter 
----------+-----------+-----------------------------------------+----------------
- public  | basic_dml | {id,data,something,subonly,subonly_def} | f
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | 
-(1 row)
-
--- data should get replicated to subscriber
-SELECT id, data, something FROM basic_dml ORDER BY id;
- id | data |    something     
-----+------+------------------
-  1 | foo  | @ 1 min
-  2 | bar  | @ 84 days
-  3 | baz  | @ 2 years 1 hour
-  4 | qux  | @ 8 mons 2 days
-  5 |      | 
-(5 rows)
-
-\c :provider_dsn
--- Adding a table that's already selectively replicated fails
-\set VERBOSITY terse
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', synchronize_data := true);
-ERROR:  duplicate key value violates unique constraint "replication_set_table_pkey"
-\set VERBOSITY default
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
--- So does trying to re-add to change the column set
-\set VERBOSITY terse
-SELECT * FROM spock.repset_add_table('default', 'basic_dml', synchronize_data := true, columns := '{id, data}');
-ERROR:  duplicate key value violates unique constraint "replication_set_table_pkey"
-\set VERBOSITY default
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
--- Shouldn't be able to drop a replicated col in a rel
--- but due to RM#5916 you can
-BEGIN;
-ALTER TABLE public.basic_dml DROP COLUMN data;
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |    att_list    | has_row_filter 
----------+-----------+----------------+----------------
- public  | basic_dml | {id,something} | f
-(1 row)
-
-ROLLBACK;
--- Even when wrapped (RM#5916)
-BEGIN;
-SELECT spock.replicate_ddl($$
-ALTER TABLE public.basic_dml DROP COLUMN data;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |    att_list    | has_row_filter 
----------+-----------+----------------+----------------
- public  | basic_dml | {id,something} | f
-(1 row)
-
-ROLLBACK;
--- CASCADE should be allowed though
-BEGIN;
-ALTER TABLE public.basic_dml DROP COLUMN data CASCADE;
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |    att_list    | has_row_filter 
----------+-----------+----------------+----------------
- public  | basic_dml | {id,something} | f
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-ROLLBACK;
-BEGIN;
-SELECT spock.replicate_ddl($$
-ALTER TABLE public.basic_dml DROP COLUMN data CASCADE;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT nspname, relname, att_list, has_row_filter FROM spock.repset_show_table('basic_dml'::regclass, ARRAY['default']);
- nspname |  relname  |    att_list    | has_row_filter 
----------+-----------+----------------+----------------
- public  | basic_dml | {id,something} | f
-(1 row)
-
-SELECT nspname, relname, set_name FROM spock.tables
-WHERE relid = 'public.basic_dml'::regclass;
- nspname |  relname  | set_name 
----------+-----------+----------
- public  | basic_dml | default
-(1 row)
-
-ROLLBACK;
--- We can drop a non-replicated col. We must not replicate this DDL because in
--- this case the downstream doesn't have the 'other' column and apply will
--- fail.
-ALTER TABLE public.basic_dml DROP COLUMN other;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.basic_dml CASCADE;
-$$);
-NOTICE:  drop cascades to table basic_dml membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/apply_delay.out /Users/pgedge/pgedge/spock-ibrar/results/apply_delay.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/apply_delay.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/apply_delay.out	2025-12-04 16:02:53
@@ -1,172 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :subscriber_dsn
-GRANT ALL ON SCHEMA public TO nonsuper;
-SELECT E'\'' || current_database() || E'\'' AS subdb;
-   subdb    
-------------
- 'postgres'
-(1 row)
-
-\gset
-\c :provider_dsn
-SELECT * FROM spock.repset_create('delay');
- repset_create 
----------------
-    2635062563
-(1 row)
-
-\c :subscriber_dsn
-CREATE or REPLACE function int2interval (x integer) returns interval as
-$$ select $1*'1 sec'::interval $$
-language sql;
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription_delay',
-    provider_dsn := (SELECT provider_dsn FROM spock_regress_variables()) || ' user=super',
-	replication_sets := '{delay}',
-	forward_origins := '{}',
-	synchronize_structure := false,
-	synchronize_data := false,
-	apply_delay := int2interval(2) -- 2 seconds
-);
- sub_create 
-------------
-          3
-(1 row)
-
-BEGIN;
-SET LOCAL statement_timeout = '30s';
-SELECT spock.sub_wait_for_sync('test_subscription_delay');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-SELECT sync_kind, sync_subid, sync_nspname, sync_relname, sync_status IN ('y', 'r') FROM spock.local_sync_status ORDER BY 2,3,4;
- sync_kind | sync_subid | sync_nspname | sync_relname | ?column? 
------------+------------+--------------+--------------+----------
- f         |          1 |              |              | t
- i         |          3 |              |              | t
-(2 rows)
-
-SELECT status FROM spock.sub_show_status() WHERE subscription_name = 'test_subscription_delay';
-   status    
--------------
- replicating
-(1 row)
-
--- Make sure we see the slot and active connection
-\c :provider_dsn
-SELECT plugin, slot_type, database, active FROM pg_replication_slots;
-    plugin    | slot_type |  database  | active 
---------------+-----------+------------+--------
- spock_output | logical   | regression | t
- spock_output | logical   | regression | t
-(2 rows)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     2
-(1 row)
-
-CREATE TABLE public.timestamps (
-        id text primary key,
-        ts timestamptz
-);
-SELECT spock.replicate_ddl($$
-    CREATE TABLE public.basic_dml1 (
-        id serial primary key,
-        other integer,
-        data text,
-        something interval
-    );
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
--- clear old applies, from any previous tests etc.
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO timestamps VALUES ('ts1', CURRENT_TIMESTAMP);
-SELECT * FROM spock.repset_add_table('delay', 'basic_dml1');
- repset_add_table 
-------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO timestamps VALUES ('ts2', CURRENT_TIMESTAMP);
-INSERT INTO basic_dml1(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-INSERT INTO timestamps VALUES ('ts3', CURRENT_TIMESTAMP);
-SELECT round (EXTRACT(EPOCH FROM (SELECT ts from timestamps where id = 'ts2')) -
-       EXTRACT(EPOCH FROM (SELECT ts from timestamps where id = 'ts1'))) :: integer >= 2 as ddl_replication_delayed;
- ddl_replication_delayed 
--------------------------
- t
-(1 row)
-
-SELECT round (EXTRACT(EPOCH FROM (SELECT ts from timestamps where id = 'ts3')) -
-       EXTRACT(EPOCH FROM (SELECT ts from timestamps where id = 'ts2'))) :: integer >= 2 as inserts_replication_delayed;
- inserts_replication_delayed 
------------------------------
- t
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM basic_dml1;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(5 rows)
-
-SELECT spock.sub_drop('test_subscription_delay');
- sub_drop 
-----------
-        1
-(1 row)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT * FROM spock.repset_drop('delay');
- repset_drop 
--------------
- t
-(1 row)
-
-DROP TABLE public.timestamps CASCADE;
-SELECT spock.replicate_ddl($$
-    DROP TABLE public.basic_dml1 CASCADE;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":subscriber_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/extended.out /Users/pgedge/pgedge/spock-ibrar/results/extended.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/extended.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/extended.out	2025-12-04 16:02:53
@@ -1,1434 +1,7 @@
 -- complex datatype handling
 SELECT * FROM spock_regress_variables()
 \gset
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.tst_one_array (
-		a INTEGER PRIMARY KEY,
-		b INTEGER[]
-		);
-	CREATE TABLE public.tst_arrays (
-		a INTEGER[] PRIMARY KEY,
-		b TEXT[],
-		c FLOAT[],
-		d INTERVAL[]
-		);
-
-	CREATE TYPE public.tst_enum_t AS ENUM ('a', 'b', 'c', 'd', 'e');
-	CREATE TABLE public.tst_one_enum (
-		a INTEGER PRIMARY KEY,
-		b public.tst_enum_t
-		);
-	CREATE TABLE public.tst_enums (
-		a public.tst_enum_t PRIMARY KEY,
-		b public.tst_enum_t[]
-		);
-
-	CREATE TYPE public.tst_comp_basic_t AS (a FLOAT, b TEXT, c INTEGER);
-	CREATE TYPE public.tst_comp_enum_t AS (a FLOAT, b public.tst_enum_t, c INTEGER);
-	CREATE TYPE public.tst_comp_enum_array_t AS (a FLOAT, b public.tst_enum_t[], c INTEGER);
-	CREATE TABLE public.tst_one_comp (
-		a INTEGER PRIMARY KEY,
-		b public.tst_comp_basic_t
-		);
-	CREATE TABLE public.tst_comps (
-		a public.tst_comp_basic_t PRIMARY KEY,
-		b public.tst_comp_basic_t[]
-		);
-	CREATE TABLE public.tst_comp_enum (
-		a INTEGER PRIMARY KEY,
-		b public.tst_comp_enum_t
-		);
-	CREATE TABLE public.tst_comp_enum_array (
-		a public.tst_comp_enum_t PRIMARY KEY,
-		b public.tst_comp_enum_t[]
-		);
-	CREATE TABLE public.tst_comp_one_enum_array (
-		a INTEGER PRIMARY KEY,
-		b public.tst_comp_enum_array_t
-		);
-	CREATE TABLE public.tst_comp_enum_what (
-		a public.tst_comp_enum_array_t PRIMARY KEY,
-		b public.tst_comp_enum_array_t[]
-		);
-
-	CREATE TYPE public.tst_comp_mix_t AS (
-		a public.tst_comp_basic_t,
-		b public.tst_comp_basic_t[],
-		c public.tst_enum_t,
-		d public.tst_enum_t[]
-		);
-	CREATE TABLE public.tst_comp_mix_array (
-		a public.tst_comp_mix_t PRIMARY KEY,
-		b public.tst_comp_mix_t[]
-		);
-	CREATE TABLE public.tst_range (
-		a INTEGER PRIMARY KEY,
-		b int4range
-	);
-	CREATE TABLE public.tst_range_array (
-		a INTEGER PRIMARY KEY,
-		b TSTZRANGE,
-		c int8range[]
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_all_tables('default', '{public}');
- repset_add_all_tables 
------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
--- test_tbl_one_array_col
-INSERT INTO tst_one_array (a, b) VALUES
-    (1, '{1, 2, 3}'),
-    (2, '{2, 3, 1}'),
-    (3, '{3, 2, 1}'),
-    (4, '{4, 3, 2}'),
-    (5, '{5, NULL, 3}');
--- test_tbl_arrays
-INSERT INTO tst_arrays (a, b, c, d) VALUES
-    ('{1, 2, 3}', '{"a", "b", "c"}', '{1.1, 2.2, 3.3}', '{"1 day", "2 days", "3 days"}'),
-    ('{2, 3, 1}', '{"b", "c", "a"}', '{2.2, 3.3, 1.1}', '{"2 minutes", "3 minutes", "1 minute"}'),
-    ('{3, 1, 2}', '{"c", "a", "b"}', '{3.3, 1.1, 2.2}', '{"3 years", "1 year", "2 years"}'),
-    ('{4, 1, 2}', '{"d", "a", "b"}', '{4.4, 1.1, 2.2}', '{"4 years", "1 year", "2 years"}'),
-    ('{5, NULL, NULL}', '{"e", NULL, "b"}', '{5.5, 1.1, NULL}', '{"5 years", NULL, NULL}');
--- test_tbl_single_enum
-INSERT INTO tst_one_enum (a, b) VALUES
-    (1, 'a'),
-    (2, 'b'),
-    (3, 'c'),
-    (4, 'd'),
-    (5, NULL);
--- test_tbl_enums
-INSERT INTO tst_enums (a, b) VALUES
-    ('a', '{b, c}'),
-    ('b', '{c, a}'),
-    ('c', '{b, a}'),
-    ('d', '{c, b}'),
-    ('e', '{d, NULL}');
--- test_tbl_single_composites
-INSERT INTO tst_one_comp (a, b) VALUES
-    (1, ROW(1.0, 'a', 1)),
-    (2, ROW(2.0, 'b', 2)),
-    (3, ROW(3.0, 'c', 3)),
-    (4, ROW(4.0, 'd', 4)),
-    (5, ROW(NULL, NULL, 5));
--- test_tbl_composites
-INSERT INTO tst_comps (a, b) VALUES
-    (ROW(1.0, 'a', 1), ARRAY[ROW(1, 'a', 1)::tst_comp_basic_t]),
-    (ROW(2.0, 'b', 2), ARRAY[ROW(2, 'b', 2)::tst_comp_basic_t]),
-    (ROW(3.0, 'c', 3), ARRAY[ROW(3, 'c', 3)::tst_comp_basic_t]),
-    (ROW(4.0, 'd', 4), ARRAY[ROW(4, 'd', 3)::tst_comp_basic_t]),
-    (ROW(5.0, 'e', NULL), ARRAY[NULL, ROW(5, NULL, 5)::tst_comp_basic_t]);
--- test_tbl_composite_with_enums
-INSERT INTO tst_comp_enum (a, b) VALUES
-    (1, ROW(1.0, 'a', 1)),
-    (2, ROW(2.0, 'b', 2)),
-    (3, ROW(3.0, 'c', 3)),
-    (4, ROW(4.0, 'd', 4)),
-    (5, ROW(NULL, 'e', NULL));
--- test_tbl_composite_with_enums_array
-INSERT INTO tst_comp_enum_array (a, b) VALUES
-    (ROW(1.0, 'a', 1), ARRAY[ROW(1, 'a', 1)::tst_comp_enum_t]),
-    (ROW(2.0, 'b', 2), ARRAY[ROW(2, 'b', 2)::tst_comp_enum_t]),
-    (ROW(3.0, 'c', 3), ARRAY[ROW(3, 'c', 3)::tst_comp_enum_t]),
-    (ROW(4.0, 'd', 3), ARRAY[ROW(3, 'd', 3)::tst_comp_enum_t]),
-    (ROW(5.0, 'e', 3), ARRAY[ROW(3, 'e', 3)::tst_comp_enum_t, NULL]);
--- test_tbl_composite_with_single_enums_array_in_composite
-INSERT INTO tst_comp_one_enum_array (a, b) VALUES
-    (1, ROW(1.0, '{a, b, c}', 1)),
-    (2, ROW(2.0, '{a, b, c}', 2)),
-    (3, ROW(3.0, '{a, b, c}', 3)),
-    (4, ROW(4.0, '{c, b, d}', 4)),
-    (5, ROW(5.0, '{NULL, e, NULL}', 5));
--- test_tbl_composite_with_enums_array_in_composite
-INSERT INTO tst_comp_enum_what (a, b) VALUES
-    (ROW(1.0, '{a, b, c}', 1), ARRAY[ROW(1, '{a, b, c}', 1)::tst_comp_enum_array_t]),
-    (ROW(2.0, '{b, c, a}', 2), ARRAY[ROW(2, '{b, c, a}', 1)::tst_comp_enum_array_t]),
-    (ROW(3.0, '{c, a, b}', 1), ARRAY[ROW(3, '{c, a, b}', 1)::tst_comp_enum_array_t]),
-    (ROW(4.0, '{c, b, d}', 4), ARRAY[ROW(4, '{c, b, d}', 4)::tst_comp_enum_array_t]),
-    (ROW(5.0, '{c, NULL, b}', NULL), ARRAY[ROW(5, '{c, e, b}', 1)::tst_comp_enum_array_t]);
--- test_tbl_mixed_composites
-INSERT INTO tst_comp_mix_array (a, b) VALUES
-    (ROW(
-        ROW(1,'a',1),
-        ARRAY[ROW(1,'a',1)::tst_comp_basic_t, ROW(2,'b',2)::tst_comp_basic_t],
-        'a',
-        '{a,b,NULL,c}'),
-    ARRAY[
-        ROW(
-            ROW(1,'a',1),
-            ARRAY[
-                ROW(1,'a',1)::tst_comp_basic_t,
-                ROW(2,'b',2)::tst_comp_basic_t,
-                NULL
-                ],
-            'a',
-            '{a,b,c}'
-            )::tst_comp_mix_t
-        ]
-    );
--- test_tbl_range
-INSERT INTO tst_range (a, b) VALUES
-    (1, '[1, 10]'),
-    (2, '[2, 20]'),
-    (3, '[3, 30]'),
-    (4, '[4, 40]'),
-    (5, '[5, 50]');
--- test_tbl_range_array
-INSERT INTO tst_range_array (a, b, c) VALUES
-    (1, tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz, 'infinity'), '{"[1,2]", "[10,20]"}'),
-    (2, tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz - interval '2 days', 'Mon Aug 04 00:00:00 2014 CEST'::timestamptz), '{"[2,3]", "[20,30]"}'),
-    (3, tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz - interval '3 days', 'Mon Aug 04 00:00:00 2014 CEST'::timestamptz), '{"[3,4]"}'),
-    (4, tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz - interval '4 days', 'Mon Aug 04 00:00:00 2014 CEST'::timestamptz), '{"[4,5]", NULL, "[40,50]"}'),
-    (5, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a |     b      
----+------------
- 1 | {1,2,3}
- 2 | {2,3,1}
- 3 | {3,2,1}
- 4 | {4,3,2}
- 5 | {5,NULL,3}
-(5 rows)
-
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
-       a       |     b      |       c        |                  d                   
----------------+------------+----------------+--------------------------------------
- {1,2,3}       | {a,b,c}    | {1.1,2.2,3.3}  | {"@ 1 day","@ 2 days","@ 3 days"}
- {2,3,1}       | {b,c,a}    | {2.2,3.3,1.1}  | {"@ 2 mins","@ 3 mins","@ 1 min"}
- {3,1,2}       | {c,a,b}    | {3.3,1.1,2.2}  | {"@ 3 years","@ 1 year","@ 2 years"}
- {4,1,2}       | {d,a,b}    | {4.4,1.1,2.2}  | {"@ 4 years","@ 1 year","@ 2 years"}
- {5,NULL,NULL} | {e,NULL,b} | {5.5,1.1,NULL} | {"@ 5 years",NULL,NULL}
-(5 rows)
-
-SELECT a, b FROM tst_one_enum ORDER BY a;
- a | b 
----+---
- 1 | a
- 2 | b
- 3 | c
- 4 | d
- 5 | 
-(5 rows)
-
-SELECT a, b FROM tst_enums ORDER BY a;
- a |    b     
----+----------
- a | {b,c}
- b | {c,a}
- c | {b,a}
- d | {c,b}
- e | {d,NULL}
-(5 rows)
-
-SELECT a, b FROM tst_one_comp ORDER BY a;
- a |    b    
----+---------
- 1 | (1,a,1)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,4)
- 5 | (,,5)
-(5 rows)
-
-SELECT a, b FROM tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (1,a,1) | {"(1,a,1)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,4) | {"(4,d,3)"}
- (5,e,)  | {NULL,"(5,,5)"}
-(5 rows)
-
-SELECT a, b FROM tst_comp_enum ORDER BY a;
- a |    b    
----+---------
- 1 | (1,a,1)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,4)
- 5 | (,e,)
-(5 rows)
-
-SELECT a, b FROM tst_comp_enum_array ORDER BY a;
-    a    |        b         
----------+------------------
- (1,a,1) | {"(1,a,1)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,3) | {"(3,d,3)"}
- (5,e,3) | {"(3,e,3)",NULL}
-(5 rows)
-
-SELECT a, b FROM tst_comp_one_enum_array ORDER BY a;
- a |           b           
----+-----------------------
- 1 | (1,"{a,b,c}",1)
- 2 | (2,"{a,b,c}",2)
- 3 | (3,"{a,b,c}",3)
- 4 | (4,"{c,b,d}",4)
- 5 | (5,"{NULL,e,NULL}",5)
-(5 rows)
-
-SELECT a, b FROM tst_comp_enum_what ORDER BY a;
-         a         |           b           
--------------------+-----------------------
- (1,"{a,b,c}",1)   | {"(1,\"{a,b,c}\",1)"}
- (2,"{b,c,a}",2)   | {"(2,\"{b,c,a}\",1)"}
- (3,"{c,a,b}",1)   | {"(3,\"{c,a,b}\",1)"}
- (4,"{c,b,d}",4)   | {"(4,\"{c,b,d}\",4)"}
- (5,"{c,NULL,b}",) | {"(5,\"{c,e,b}\",1)"}
-(5 rows)
-
-SELECT a, b FROM tst_comp_mix_array ORDER BY a;
-                            a                             |                                     b                                      
-----------------------------------------------------------+----------------------------------------------------------------------------
- ("(1,a,1)","{""(1,a,1)"",""(2,b,2)""}",a,"{a,b,NULL,c}") | {"(\"(1,a,1)\",\"{\"\"(1,a,1)\"\",\"\"(2,b,2)\"\",NULL}\",a,\"{a,b,c}\")"}
-(1 row)
-
-SELECT a, b FROM tst_range ORDER BY a;
- a |   b    
----+--------
- 1 | [1,11)
- 2 | [2,21)
- 3 | [3,31)
- 4 | [4,41)
- 5 | [5,51)
-(5 rows)
-
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |            c             
----+-----------------------------------------------------------------+--------------------------
- 1 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {"[1,3)","[10,21)"}
- 2 | ["Fri Aug 01 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[2,4)","[20,31)"}
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
- 4 | ["Wed Jul 30 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[4,6)",NULL,"[40,51)"}
- 5 |                                                                 | 
-(5 rows)
-
--- test_tbl_one_array_col
-\c :provider_dsn
-UPDATE tst_one_array SET b = '{4, 5, 6}' WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a |     b      
----+------------
- 1 | {4,5,6}
- 2 | {2,3,1}
- 3 | {3,2,1}
- 4 | {4,3,2}
- 5 | {5,NULL,3}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_one_array SET b = '{4, 5, 6, 1}' WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a |     b     
----+-----------
- 1 | {4,5,6}
- 2 | {2,3,1}
- 3 | {3,2,1}
- 4 | {4,5,6,1}
- 5 | {4,5,6,1}
-(5 rows)
-
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-DELETE FROM tst_one_array WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a |     b     
----+-----------
- 2 | {2,3,1}
- 3 | {3,2,1}
- 4 | {4,5,6,1}
- 5 | {4,5,6,1}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_array WHERE b = '{2, 3, 1}';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a |     b     
----+-----------
- 3 | {3,2,1}
- 4 | {4,5,6,1}
- 5 | {4,5,6,1}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_array WHERE 1 = ANY(b);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_array ORDER BY a;
- a | b 
----+---
-(0 rows)
-
--- test_tbl_arrays
-\c :provider_dsn
-UPDATE tst_arrays SET b = '{"1a", "2b", "3c"}', c = '{1.0, 2.0, 3.0}', d = '{"1 day 1 second", "2 days 2 seconds", "3 days 3 second"}' WHERE a = '{1, 2, 3}';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
-       a       |     b      |       c        |                           d                           
----------------+------------+----------------+-------------------------------------------------------
- {1,2,3}       | {1a,2b,3c} | {1,2,3}        | {"@ 1 day 1 sec","@ 2 days 2 secs","@ 3 days 3 secs"}
- {2,3,1}       | {b,c,a}    | {2.2,3.3,1.1}  | {"@ 2 mins","@ 3 mins","@ 1 min"}
- {3,1,2}       | {c,a,b}    | {3.3,1.1,2.2}  | {"@ 3 years","@ 1 year","@ 2 years"}
- {4,1,2}       | {d,a,b}    | {4.4,1.1,2.2}  | {"@ 4 years","@ 1 year","@ 2 years"}
- {5,NULL,NULL} | {e,NULL,b} | {5.5,1.1,NULL} | {"@ 5 years",NULL,NULL}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_arrays SET b = '{"c", "d", "e"}', c = '{3.0, 4.0, 5.0}', d = '{"3 day 1 second", "4 days 2 seconds", "5 days 3 second"}' WHERE a[1] > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
-       a       |     b      |       c       |                           d                            
----------------+------------+---------------+--------------------------------------------------------
- {1,2,3}       | {1a,2b,3c} | {1,2,3}       | {"@ 1 day 1 sec","@ 2 days 2 secs","@ 3 days 3 secs"}
- {2,3,1}       | {b,c,a}    | {2.2,3.3,1.1} | {"@ 2 mins","@ 3 mins","@ 1 min"}
- {3,1,2}       | {c,a,b}    | {3.3,1.1,2.2} | {"@ 3 years","@ 1 year","@ 2 years"}
- {4,1,2}       | {c,d,e}    | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
- {5,NULL,NULL} | {c,d,e}    | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_arrays WHERE a = '{1, 2, 3}';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
-       a       |    b    |       c       |                           d                            
----------------+---------+---------------+--------------------------------------------------------
- {2,3,1}       | {b,c,a} | {2.2,3.3,1.1} | {"@ 2 mins","@ 3 mins","@ 1 min"}
- {3,1,2}       | {c,a,b} | {3.3,1.1,2.2} | {"@ 3 years","@ 1 year","@ 2 years"}
- {4,1,2}       | {c,d,e} | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
- {5,NULL,NULL} | {c,d,e} | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_arrays WHERE a[1] = 2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
-       a       |    b    |       c       |                           d                            
----------------+---------+---------------+--------------------------------------------------------
- {3,1,2}       | {c,a,b} | {3.3,1.1,2.2} | {"@ 3 years","@ 1 year","@ 2 years"}
- {4,1,2}       | {c,d,e} | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
- {5,NULL,NULL} | {c,d,e} | {3,4,5}       | {"@ 3 days 1 sec","@ 4 days 2 secs","@ 5 days 3 secs"}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_arrays WHERE b[1] = 'c';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c, d FROM tst_arrays ORDER BY a;
- a | b | c | d 
----+---+---+---
-(0 rows)
-
--- test_tbl_single_enum
-\c :provider_dsn
-UPDATE tst_one_enum SET b = 'c' WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_enum ORDER BY a;
- a | b 
----+---
- 1 | c
- 2 | b
- 3 | c
- 4 | d
- 5 | 
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_one_enum SET b = NULL WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_enum ORDER BY a;
- a | b 
----+---
- 1 | c
- 2 | b
- 3 | c
- 4 | 
- 5 | 
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_enum WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_enum ORDER BY a;
- a | b 
----+---
- 2 | b
- 3 | c
- 4 | 
- 5 | 
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_enum WHERE b = 'b';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_one_enum ORDER BY a;
- a | b 
----+---
- 3 | c
- 4 | 
- 5 | 
-(3 rows)
-
--- test_tbl_enums
-\c :provider_dsn
-UPDATE tst_enums SET b = '{e, NULL}' WHERE a = 'a';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_enums;
- a |    b     
----+----------
- b | {c,a}
- c | {b,a}
- d | {c,b}
- e | {d,NULL}
- a | {e,NULL}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_enums SET b = '{e, d}' WHERE a > 'c';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_enums;
- a |    b     
----+----------
- b | {c,a}
- c | {b,a}
- a | {e,NULL}
- d | {e,d}
- e | {e,d}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_enums WHERE a = 'a';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_enums;
- a |   b   
----+-------
- b | {c,a}
- c | {b,a}
- d | {e,d}
- e | {e,d}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_enums WHERE 'c' = ANY(b);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_enums;
- a |   b   
----+-------
- c | {b,a}
- d | {e,d}
- e | {e,d}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_enums WHERE b[1] = 'b';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_enums;
- a |   b   
----+-------
- d | {e,d}
- e | {e,d}
-(2 rows)
-
--- test_tbl_single_composites
-\c :provider_dsn
-UPDATE tst_one_comp SET b = ROW(1.0, 'A', 1) WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_one_comp ORDER BY a;
- a |    b    
----+---------
- 1 | (1,A,1)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,4)
- 5 | (,,5)
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_one_comp SET b = ROW(NULL, 'x', -1) WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_one_comp ORDER BY a;
- a |    b    
----+---------
- 1 | (1,A,1)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (,x,-1)
- 5 | (,x,-1)
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_comp WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_one_comp ORDER BY a;
- a |    b    
----+---------
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (,x,-1)
- 5 | (,x,-1)
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_one_comp WHERE (b).a = 2.0;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_one_comp ORDER BY a;
- a |    b    
----+---------
- 3 | (3,c,3)
- 4 | (,x,-1)
- 5 | (,x,-1)
-(3 rows)
-
--- test_tbl_composites
-\c :provider_dsn
-UPDATE tst_comps SET b = ARRAY[ROW(9, 'x', -1)::tst_comp_basic_t] WHERE (a).a = 1.0;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (1,a,1) | {"(9,x,-1)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,4) | {"(4,d,3)"}
- (5,e,)  | {NULL,"(5,,5)"}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_comps SET b = ARRAY[NULL, ROW(9, 'x', NULL)::tst_comp_basic_t] WHERE (a).a > 3.9;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (1,a,1) | {"(9,x,-1)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,4) | {NULL,"(9,x,)"}
- (5,e,)  | {NULL,"(9,x,)"}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comps WHERE (a).b = 'a';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,4) | {NULL,"(9,x,)"}
- (5,e,)  | {NULL,"(9,x,)"}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comps WHERE (b[1]).a = 2.0;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (3,c,3) | {"(3,c,3)"}
- (4,d,4) | {NULL,"(9,x,)"}
- (5,e,)  | {NULL,"(9,x,)"}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comps WHERE ROW(3, 'c', 3)::tst_comp_basic_t = ANY(b);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comps ORDER BY a;
-    a    |        b        
----------+-----------------
- (4,d,4) | {NULL,"(9,x,)"}
- (5,e,)  | {NULL,"(9,x,)"}
-(2 rows)
-
--- test_tbl_composite_with_enums
-\c :provider_dsn
-UPDATE tst_comp_enum SET b = ROW(1.0, NULL, NULL) WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum ORDER BY a;
- a |    b    
----+---------
- 1 | (1,,)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,4)
- 5 | (,e,)
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_comp_enum SET b = ROW(4.0, 'd', 44) WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum ORDER BY a;
- a |    b     
----+----------
- 1 | (1,,)
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,44)
- 5 | (4,d,44)
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum ORDER BY a;
- a |    b     
----+----------
- 2 | (2,b,2)
- 3 | (3,c,3)
- 4 | (4,d,44)
- 5 | (4,d,44)
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum WHERE (b).a = 2.0;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum ORDER BY a;
- a |    b     
----+----------
- 3 | (3,c,3)
- 4 | (4,d,44)
- 5 | (4,d,44)
-(3 rows)
-
--- test_tbl_composite_with_enums_array
-\c :provider_dsn
-UPDATE tst_comp_enum_array SET b = ARRAY[NULL, ROW(3, 'd', 3)::tst_comp_enum_t] WHERE a = ROW(1.0, 'a', 1)::tst_comp_enum_t;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum_array ORDER BY a;
-    a    |        b         
----------+------------------
- (1,a,1) | {NULL,"(3,d,3)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,3) | {"(3,d,3)"}
- (5,e,3) | {"(3,e,3)",NULL}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_comp_enum_array SET b = ARRAY[ROW(1, 'a', 1)::tst_comp_enum_t, ROW(2, 'b', 2)::tst_comp_enum_t] WHERE (a).a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum_array ORDER BY a;
-    a    |           b           
----------+-----------------------
- (1,a,1) | {NULL,"(3,d,3)"}
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,3) | {"(1,a,1)","(2,b,2)"}
- (5,e,3) | {"(1,a,1)","(2,b,2)"}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_array WHERE a = ROW(1.0, 'a', 1)::tst_comp_enum_t;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_array ORDER BY a;
-    a    |           b           
----------+-----------------------
- (2,b,2) | {"(2,b,2)"}
- (3,c,3) | {"(3,c,3)"}
- (4,d,3) | {"(1,a,1)","(2,b,2)"}
- (5,e,3) | {"(1,a,1)","(2,b,2)"}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_array WHERE (b[1]).b = 'b';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_array ORDER BY a;
-    a    |           b           
----------+-----------------------
- (3,c,3) | {"(3,c,3)"}
- (4,d,3) | {"(1,a,1)","(2,b,2)"}
- (5,e,3) | {"(1,a,1)","(2,b,2)"}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_array WHERE ROW(3, 'c', 3)::tst_comp_enum_t = ANY(b);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_array ORDER BY a;
-    a    |           b           
----------+-----------------------
- (4,d,3) | {"(1,a,1)","(2,b,2)"}
- (5,e,3) | {"(1,a,1)","(2,b,2)"}
-(2 rows)
-
--- test_tbl_composite_with_single_enums_array_in_composite
-\c :provider_dsn
-UPDATE tst_comp_one_enum_array SET b = ROW(1.0, '{a, e, c}', NULL) WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_one_enum_array ORDER BY a;
- a |           b           
----+-----------------------
- 1 | (1,"{a,e,c}",)
- 2 | (2,"{a,b,c}",2)
- 3 | (3,"{a,b,c}",3)
- 4 | (4,"{c,b,d}",4)
- 5 | (5,"{NULL,e,NULL}",5)
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_comp_one_enum_array SET b = ROW(4.0, '{c, b, d}', 4) WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_one_enum_array ORDER BY a;
- a |        b        
----+-----------------
- 1 | (1,"{a,e,c}",)
- 2 | (2,"{a,b,c}",2)
- 3 | (3,"{a,b,c}",3)
- 4 | (4,"{c,b,d}",4)
- 5 | (4,"{c,b,d}",4)
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_one_enum_array WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_one_enum_array ORDER BY a;
- a |        b        
----+-----------------
- 2 | (2,"{a,b,c}",2)
- 3 | (3,"{a,b,c}",3)
- 4 | (4,"{c,b,d}",4)
- 5 | (4,"{c,b,d}",4)
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_one_enum_array WHERE (b).c = 2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_one_enum_array ORDER BY a;
- a |        b        
----+-----------------
- 3 | (3,"{a,b,c}",3)
- 4 | (4,"{c,b,d}",4)
- 5 | (4,"{c,b,d}",4)
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_one_enum_array WHERE 'a' = ANY((b).b);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_one_enum_array ORDER BY a;
- a |        b        
----+-----------------
- 4 | (4,"{c,b,d}",4)
- 5 | (4,"{c,b,d}",4)
-(2 rows)
-
--- test_tbl_composite_with_enums_array_in_composite
-\c :provider_dsn
-UPDATE tst_comp_enum_what SET b = ARRAY[NULL, ROW(1, '{a, b, c}', 1)::tst_comp_enum_array_t, ROW(NULL, '{a, e, c}', 2)::tst_comp_enum_array_t] WHERE (a).a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum_what ORDER BY a;
-         a         |                       b                       
--------------------+-----------------------------------------------
- (1,"{a,b,c}",1)   | {NULL,"(1,\"{a,b,c}\",1)","(,\"{a,e,c}\",2)"}
- (2,"{b,c,a}",2)   | {"(2,\"{b,c,a}\",1)"}
- (3,"{c,a,b}",1)   | {"(3,\"{c,a,b}\",1)"}
- (4,"{c,b,d}",4)   | {"(4,\"{c,b,d}\",4)"}
- (5,"{c,NULL,b}",) | {"(5,\"{c,e,b}\",1)"}
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_comp_enum_what SET b = ARRAY[ROW(5, '{a, b, c}', 5)::tst_comp_enum_array_t] WHERE (a).a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b from tst_comp_enum_what ORDER BY a;
-         a         |                       b                       
--------------------+-----------------------------------------------
- (1,"{a,b,c}",1)   | {NULL,"(1,\"{a,b,c}\",1)","(,\"{a,e,c}\",2)"}
- (2,"{b,c,a}",2)   | {"(2,\"{b,c,a}\",1)"}
- (3,"{c,a,b}",1)   | {"(3,\"{c,a,b}\",1)"}
- (4,"{c,b,d}",4)   | {"(5,\"{a,b,c}\",5)"}
- (5,"{c,NULL,b}",) | {"(5,\"{a,b,c}\",5)"}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_what WHERE (a).a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_what ORDER BY a;
-         a         |           b           
--------------------+-----------------------
- (2,"{b,c,a}",2)   | {"(2,\"{b,c,a}\",1)"}
- (3,"{c,a,b}",1)   | {"(3,\"{c,a,b}\",1)"}
- (4,"{c,b,d}",4)   | {"(5,\"{a,b,c}\",5)"}
- (5,"{c,NULL,b}",) | {"(5,\"{a,b,c}\",5)"}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_what WHERE (b[1]).a = 2;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_what ORDER BY a;
-         a         |           b           
--------------------+-----------------------
- (3,"{c,a,b}",1)   | {"(3,\"{c,a,b}\",1)"}
- (4,"{c,b,d}",4)   | {"(5,\"{a,b,c}\",5)"}
- (5,"{c,NULL,b}",) | {"(5,\"{a,b,c}\",5)"}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_comp_enum_what WHERE (b[1]).b = '{c, a, b}';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_enum_what ORDER BY a;
-         a         |           b           
--------------------+-----------------------
- (4,"{c,b,d}",4)   | {"(5,\"{a,b,c}\",5)"}
- (5,"{c,NULL,b}",) | {"(5,\"{a,b,c}\",5)"}
-(2 rows)
-
--- test_tbl_mixed_composites
-\c :provider_dsn
-UPDATE tst_comp_mix_array SET b[2] = NULL WHERE ((a).a).a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_mix_array ORDER BY a;
-                            a                             |                                        b                                        
-----------------------------------------------------------+---------------------------------------------------------------------------------
- ("(1,a,1)","{""(1,a,1)"",""(2,b,2)""}",a,"{a,b,NULL,c}") | {"(\"(1,a,1)\",\"{\"\"(1,a,1)\"\",\"\"(2,b,2)\"\",NULL}\",a,\"{a,b,c}\")",NULL}
-(1 row)
-
-\c :provider_dsn
-DELETE FROM tst_comp_mix_array WHERE ((a).a).a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_comp_mix_array ORDER BY a;
- a | b 
----+---
-(0 rows)
-
--- test_tbl_range
-\c :provider_dsn
-UPDATE tst_range SET b = '[100, 1000]' WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_range ORDER BY a;
- a |     b      
----+------------
- 1 | [100,1001)
- 2 | [2,21)
- 3 | [3,31)
- 4 | [4,41)
- 5 | [5,51)
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_range SET b = '(1, 90)' WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_range ORDER BY a;
- a |     b      
----+------------
- 1 | [100,1001)
- 2 | [2,21)
- 3 | [3,31)
- 4 | [2,90)
- 5 | [2,90)
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_range ORDER BY a;
- a |   b    
----+--------
- 2 | [2,21)
- 3 | [3,31)
- 4 | [2,90)
- 5 | [2,90)
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range WHERE b = '[2, 20]';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_range ORDER BY a;
- a |   b    
----+--------
- 3 | [3,31)
- 4 | [2,90)
- 5 | [2,90)
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range WHERE '[10,20]' && b;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b FROM tst_range ORDER BY a;
- a | b 
----+---
-(0 rows)
-
--- test_tbl_range_array
-\c :provider_dsn
-UPDATE tst_range_array SET c = '{"[100, 1000]"}' WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |            c             
----+-----------------------------------------------------------------+--------------------------
- 1 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {"[100,1001)"}
- 2 | ["Fri Aug 01 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[2,4)","[20,31)"}
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
- 4 | ["Wed Jul 30 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[4,6)",NULL,"[40,51)"}
- 5 |                                                                 | 
-(5 rows)
-
-\c :provider_dsn
-UPDATE tst_range_array SET b = tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz, 'infinity'), c = '{NULL, "[11,9999999]"}' WHERE a > 3;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |           c            
----+-----------------------------------------------------------------+------------------------
- 1 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {"[100,1001)"}
- 2 | ["Fri Aug 01 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[2,4)","[20,31)"}
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
- 4 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
- 5 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
-(5 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range_array WHERE a = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |           c            
----+-----------------------------------------------------------------+------------------------
- 2 | ["Fri Aug 01 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[2,4)","[20,31)"}
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
- 4 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
- 5 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
-(4 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range_array WHERE b = tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz - interval '2 days', 'Mon Aug 04 00:00:00 2014 CEST'::timestamptz);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |           c            
----+-----------------------------------------------------------------+------------------------
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
- 4 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
- 5 | ["Sun Aug 03 15:00:00 2014 PDT",infinity)                       | {NULL,"[11,10000000)"}
-(3 rows)
-
-\c :provider_dsn
-DELETE FROM tst_range_array WHERE tstzrange('Mon Aug 04 00:00:00 2014 CEST'::timestamptz, 'Mon Aug 05 00:00:00 2014 CEST'::timestamptz) && b;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT a, b, c FROM tst_range_array ORDER BY a;
- a |                                b                                |     c     
----+-----------------------------------------------------------------+-----------
- 3 | ["Thu Jul 31 15:00:00 2014 PDT","Sun Aug 03 15:00:00 2014 PDT") | {"[3,5)"}
-(1 row)
-
-\c :provider_dsn
--- Verify that swap_relation_files(...) breaks replication
--- as invoked by CLUSTER, VACUUM FULL, or REFRESH MATERIALIZED VIEW
-VACUUM FULL tst_one_array;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.tst_one_array CASCADE;
-	DROP TABLE public.tst_arrays CASCADE;
-	DROP TABLE public.tst_one_enum CASCADE;
-	DROP TABLE public.tst_enums CASCADE;
-	DROP TABLE public.tst_one_comp CASCADE;
-	DROP TABLE public.tst_comps CASCADE;
-	DROP TABLE public.tst_comp_enum CASCADE;
-	DROP TABLE public.tst_comp_enum_array CASCADE;
-	DROP TABLE public.tst_comp_one_enum_array CASCADE;
-	DROP TABLE public.tst_comp_enum_what CASCADE;
-	DROP TABLE public.tst_comp_mix_array CASCADE;
-	DROP TABLE public.tst_range CASCADE;
-	DROP TABLE public.tst_range_array CASCADE;
-
-	DROP TYPE public.tst_comp_mix_t;
-	DROP TYPE public.tst_comp_enum_array_t;
-	DROP TYPE public.tst_comp_enum_t;
-	DROP TYPE public.tst_comp_basic_t;
-	DROP TYPE public.tst_enum_t;
-$$);
-NOTICE:  drop cascades to table tst_one_array membership in replication set default
-NOTICE:  drop cascades to table tst_arrays membership in replication set default
-NOTICE:  drop cascades to table tst_one_enum membership in replication set default
-NOTICE:  drop cascades to table tst_enums membership in replication set default
-NOTICE:  drop cascades to table tst_one_comp membership in replication set default
-NOTICE:  drop cascades to table tst_comps membership in replication set default
-NOTICE:  drop cascades to table tst_comp_enum membership in replication set default
-NOTICE:  drop cascades to table tst_comp_enum_array membership in replication set default
-NOTICE:  drop cascades to table tst_comp_one_enum_array membership in replication set default
-NOTICE:  drop cascades to table tst_comp_enum_what membership in replication set default
-NOTICE:  drop cascades to table tst_comp_mix_array membership in replication set default
-NOTICE:  drop cascades to table tst_range membership in replication set default
-NOTICE:  drop cascades to table tst_range_array membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/node_origin_cascade.out /Users/pgedge/pgedge/spock-ibrar/results/node_origin_cascade.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/node_origin_cascade.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/node_origin_cascade.out	2025-12-04 16:02:53
@@ -1,214 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT E'\'' || current_database() || E'\'' AS pubdb;
-    pubdb     
---------------
- 'regression'
-(1 row)
-
-\gset
-\c :orig_provider_dsn
-SET client_min_messages = 'warning';
-GRANT ALL ON SCHEMA public TO nonsuper;
-SET client_min_messages = 'warning';
-DO $$
-BEGIN
-        CREATE EXTENSION IF NOT EXISTS spock;
-END;
-$$;
-ALTER EXTENSION spock UPDATE;
-SELECT * FROM spock.node_create(node_name := 'test_orig_provider', dsn := (SELECT orig_provider_dsn FROM spock_regress_variables()) || ' user=super');
- node_create 
--------------
-       63171
-(1 row)
-
-\c :provider_dsn
-SET client_min_messages = 'warning';
--- test_provider spock node already exists here.
-BEGIN;
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_orig_subscription',
-    provider_dsn := (SELECT orig_provider_dsn FROM spock_regress_variables()) || ' user=super',
-	synchronize_structure := false,
-        synchronize_data := true,
-	forward_origins := '{}');
- sub_create 
-------------
-          2
-(1 row)
-
-COMMIT;
-BEGIN;
-SET LOCAL statement_timeout = '10s';
-SELECT spock.sub_wait_for_sync('test_orig_subscription');
- sub_wait_for_sync 
--------------------
- 
-(1 row)
-
-COMMIT;
-SELECT subscription_name, status, provider_node, replication_sets, forward_origins FROM spock.sub_show_status();
-   subscription_name    |   status    |   provider_node    |           replication_sets            | forward_origins 
-------------------------+-------------+--------------------+---------------------------------------+-----------------
- test_orig_subscription | replicating | test_orig_provider | {default,default_insert_only,ddl_sql} | 
-(1 row)
-
-SELECT sync_kind, sync_subid, sync_nspname, sync_relname, sync_status IN ('y', 'r') FROM spock.local_sync_status ORDER BY 2,3,4;
- sync_kind | sync_subid | sync_nspname | sync_relname | ?column? 
------------+------------+--------------+--------------+----------
- d         |          2 |              |              | t
-(1 row)
-
--- Make sure we see the slot and active connection
-\c :orig_provider_dsn
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
- spock_output | logical   | t
-(2 rows)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     2
-(1 row)
-
--- Table that replicates from top level provider to mid-level spock node.
-\c :orig_provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.top_level_tbl (
-		id serial primary key,
-		other integer,
-		data text,
-		something interval
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'top_level_tbl');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO top_level_tbl(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
-SELECT id, other, data, something FROM top_level_tbl ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(5 rows)
-
--- Table that replicates from top level provider to mid-level spock node.
-SELECT spock.replicate_ddl($$
-	CREATE TABLE public.mid_level_tbl (
-		id serial primary key,
-		other integer,
-		data text,
-		something interval
-	);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'mid_level_tbl');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO mid_level_tbl(other, data, something)
-VALUES (5, 'foo', '1 minute'::interval),
-       (4, 'bar', '12 weeks'::interval),
-       (3, 'baz', '2 years 1 hour'::interval),
-       (2, 'qux', '8 months 2 days'::interval),
-       (1, NULL, NULL);
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT id, other, data, something FROM mid_level_tbl ORDER BY id;
- id | other | data |    something     
-----+-------+------+------------------
-  1 |     5 | foo  | @ 1 min
-  2 |     4 | bar  | @ 84 days
-  3 |     3 | baz  | @ 2 years 1 hour
-  4 |     2 | qux  | @ 8 mons 2 days
-  5 |     1 |      | 
-(5 rows)
-
--- drop the tables
-\c :orig_provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.top_level_tbl CASCADE;
-$$);
-NOTICE:  drop cascades to table top_level_tbl membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-\c :provider_dsn
-\set VERBOSITY terse
-SELECT spock.replicate_ddl($$
-	DROP TABLE public.mid_level_tbl CASCADE;
-$$);
-NOTICE:  drop cascades to table mid_level_tbl membership in replication set default
- replicate_ddl 
----------------
- t
-(1 row)
-
-\c :provider_dsn
-SELECT * FROM spock.sub_drop('test_orig_subscription');
- sub_drop 
-----------
-        1
-(1 row)
-
-\c :orig_provider_dsn
-SELECT * FROM spock.node_drop(node_name := 'test_orig_provider');
- node_drop 
------------
- t
-(1 row)
-
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
-(1 row)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     1
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/multiple_upstreams_1.out /Users/pgedge/pgedge/spock-ibrar/results/multiple_upstreams.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/multiple_upstreams_1.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/multiple_upstreams.out	2025-12-04 16:02:53
@@ -1,160 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
-\c :provider1_dsn
-SET client_min_messages = 'warning';
-GRANT ALL ON SCHEMA public TO nonsuper;
-CREATE OR REPLACE FUNCTION public.pg_xlog_wait_remote_apply(i_pos pg_lsn, i_pid integer) RETURNS VOID
-AS $FUNC$
-BEGIN
-    WHILE EXISTS(SELECT true FROM pg_stat_get_wal_senders() s WHERE s.replay_location < i_pos AND (i_pid = 0 OR s.pid = i_pid)) LOOP
-		PERFORM pg_sleep(0.01);
-	END LOOP;
-END;$FUNC$ LANGUAGE plpgsql;
-SET client_min_messages = 'warning';
-DO $$
-BEGIN
-        IF (SELECT setting::integer/100 FROM pg_settings WHERE name = 'server_version_num') = 904 THEN
-                CREATE EXTENSION IF NOT EXISTS spock_origin;
-        END IF;
-END;$$;
-CREATE EXTENSION IF NOT EXISTS spock VERSION '2.0.0';
-ALTER EXTENSION spock UPDATE;
-SELECT * FROM spock.node_create(node_name := 'test_provider1', dsn := (SELECT provider1_dsn FROM spock_regress_variables()) || ' user=super');
- node_create 
--------------
-   866557357
-(1 row)
-
-\c :provider_dsn
--- add these entries to provider
-SELECT spock.replicate_ddl($$
-      CREATE TABLE public.multi_ups_tbl(id integer primary key, key text unique not null, data text);
-$$);
- replicate_ddl 
------------------------
- t
-(1 row)
-
-INSERT INTO multi_ups_tbl VALUES(1, 'key1', 'data1');
-INSERT INTO multi_ups_tbl VALUES(2, 'key2', 'data2');
-INSERT INTO multi_ups_tbl VALUES(3, 'key3', 'data3');
-SELECT * FROM spock.repset_add_table('default', 'multi_ups_tbl', true);
- repset_add_table 
------------------------
- t
-(1 row)
-
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider1_dsn
--- add these entries to provider1
-CREATE TABLE multi_ups_tbl(id integer primary key, key text unique not null, data text);
-INSERT INTO multi_ups_tbl VALUES(4, 'key4', 'data4');
-INSERT INTO multi_ups_tbl VALUES(5, 'key5', 'data5');
-INSERT INTO multi_ups_tbl VALUES(6, 'key6', 'data6');
-SELECT * FROM spock.repset_add_table('default', 'multi_ups_tbl');
- repset_add_table 
------------------------
- t
-(1 row)
-
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :subscriber_dsn
--- We'll use the already existing spock node
--- notice synchronize_structure as false when table definition already exists
-BEGIN;
-SELECT * FROM spock.sub_create(
-    subscription_name := 'test_subscription1',
-    provider_dsn := (SELECT provider1_dsn FROM spock_regress_variables()) || ' user=super',
-	synchronize_structure := false,
-	forward_origins := '{}');
- sub_create 
----------------------
-          3102546391
-(1 row)
-
-/*
- * Remove the function we added in preseed because otherwise the restore of
- * schema will fail. We do this in same transaction as sub_create()
- * because the subscription process will only start on commit.
- */
-DROP FUNCTION IF EXISTS public.spock_regress_variables();
-COMMIT;
-DO $$
-BEGIN
-	FOR i IN 1..100 LOOP
-		IF EXISTS (SELECT 1 FROM spock.show_subscription_status() WHERE status = 'replicating' and subscription_name = 'test_subscription1') THEN
-			RETURN;
-		END IF;
-		PERFORM pg_sleep(0.1);
-	END LOOP;
-END;
-$$;
-SELECT subscription_name, status, provider_node, replication_sets, forward_origins FROM spock.show_subscription_status();
- subscription_name  |   status    | provider_node  |                 replication_sets                  | forward_origins 
---------------------+-------------+----------------+-----------------------------------------+-----------------
- test_subscription  | replicating | test_provider  | {default_insert_only,ddl_sql,repset_test,default} | 
- test_subscription1 | replicating | test_provider1 | {default,default_insert_only,ddl_sql}             | 
-(2 rows)
-
-DO $$
-BEGIN
-    FOR i IN 1..300 LOOP
-        IF EXISTS (SELECT 1 FROM spock.local_sync_status WHERE sync_status = 'r') THEN
-            EXIT;
-        END IF;
-        PERFORM pg_sleep(0.1);
-    END LOOP;
-END;$$;
-SELECT sync_kind, sync_subid, sync_nspname, sync_relname, sync_status FROM spock.local_sync_status ORDER BY 2,3,4;
- sync_kind | sync_subid | sync_nspname | sync_relname  | sync_status 
------------+------------+--------------+---------------+-------------
- f         | 3102546391 | public       | multi_ups_tbl | r
- d         | 3102546391 |              |               | r
- d         | 3848008564 | public       | multi_ups_tbl | r
- f         | 3848008564 |              |               | r
-(4 rows)
-
-SELECT * from multi_ups_tbl ORDER BY id;
- id | key  | data  
-----+------+-------
-  1 | key1 | data1
-  2 | key2 | data2
-  3 | key3 | data3
-  4 | key4 | data4
-  5 | key5 | data5
-  6 | key6 | data6
-(6 rows)
-
--- Make sure we see the slot and active connection
-\c :provider1_dsn
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-      plugin      | slot_type | active 
-------------------+-----------+--------
- spock_output | logical   | t
- spock_output | logical   | t
-(2 rows)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     2
-(1 row)
-
--- cleanup
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-        DROP TABLE public.multi_ups_tbl CASCADE;
-$$);
-NOTICE:  drop cascades to table public.multi_ups_tbl membership in replication set default
-CONTEXT:  during execution of queued SQL statement: 
-        DROP TABLE public.multi_ups_tbl CASCADE;
-
- replicate_ddl 
------------------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":subscriber_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/tuple_origin.out /Users/pgedge/pgedge/spock-ibrar/results/tuple_origin.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/tuple_origin.out	2025-11-20 18:20:49
+++ /Users/pgedge/pgedge/spock-ibrar/results/tuple_origin.out	2025-12-04 16:02:53
@@ -1,227 +1,7 @@
 --Tuple Origin
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-ALTER SYSTEM SET spock.save_resolutions = on;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :subscriber_dsn
-TRUNCATE spock.resolutions;
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-    CREATE TABLE users (id int PRIMARY KEY, mgr_id int);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'users');
- repset_add_table 
-------------------
- t
-(1 row)
-
-BEGIN;
-INSERT INTO USERS SELECT 1, 5;
-UPDATE USERS SET id = id + 1 WHERE mgr_id < 10;
-UPDATE USERS SET id = id + 1 WHERE mgr_id < 10;
-END;
--- Ensure that DDL and updates is confirmed as flushed to the subscriber
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM users ORDER BY id;
- id | mgr_id 
-----+--------
-  3 |      5
-(1 row)
-
--- Expect 0 rows in spock.resolutions since the origin is the same
-SELECT COUNT(*) FROM spock.resolutions
-    WHERE relname='public.users'
-    AND local_timestamp = remote_timestamp;
- count 
--------
-     0
-(1 row)
-
--- DELETE the row from subscriber first, in order to create a conflict
-DELETE FROM users where id = 3;
-\c :provider_dsn
--- This will create a conflict on the subscriber
-DELETE FROM users where id = 3;
-\c :subscriber_dsn
--- Expect 1 row in spock.resolutions with NULL local_timestamp
-SELECT COUNT(*) FROM spock.resolutions
-    WHERE relname='public.users'
-    AND local_timestamp IS NULL;
- count 
--------
-     1
-(1 row)
-
--- More tests
-\c :provider_dsn
-SELECT spock.replicate_ddl($$
-	CREATE TABLE basic_conflict (
-		id int primary key,
-		data text);
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'basic_conflict');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO basic_conflict VALUES (1, 'A'), (2, 'B');
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-TRUNCATE spock.resolutions;
-SELECT * FROM basic_conflict ORDER BY id;
- id | data 
-----+------
-  1 | A
-  2 | B
-(2 rows)
-
-\c :provider_dsn
-UPDATE basic_conflict SET data = 'AAA' WHERE id = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM basic_conflict ORDER BY id;
- id | data 
-----+------
-  1 | AAA
-  2 | B
-(2 rows)
-
---- should return nothing
-SELECT relname, conflict_type FROM spock.resolutions WHERE relname = 'public.basic_conflict';
- relname | conflict_type 
----------+---------------
-(0 rows)
-
--- now update row locally to set up an origin difference
-UPDATE basic_conflict SET data = 'sub-A' WHERE id = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :provider_dsn
--- Update on provider again so subscriber will see
--- an origin different from its local one
-UPDATE basic_conflict SET data = 'pub-A' WHERE id = 1;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM basic_conflict ORDER BY id;
- id | data  
-----+-------
-  1 | pub-A
-  2 | B
-(2 rows)
-
--- We should now see a conflict
-SELECT relname, conflict_type FROM spock.resolutions WHERE relname = 'public.basic_conflict';
-        relname        | conflict_type 
------------------------+---------------
- public.basic_conflict | update_update
-(1 row)
-
--- Clean
-TRUNCATE spock.resolutions;
-\c :provider_dsn
--- Do update in same transaction as INSERT
-BEGIN;
-INSERT INTO basic_conflict VALUES (3, 'C');
-UPDATE basic_conflict SET data = 'pub-C' WHERE id = 3;
-COMMIT;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM basic_conflict ORDER BY id;
- id | data  
-----+-------
-  1 | pub-A
-  2 | B
-  3 | pub-C
-(3 rows)
-
--- We should not see a conflict
-SELECT relname, conflict_type FROM spock.resolutions WHERE relname = 'public.basic_conflict';
- relname | conflict_type 
----------+---------------
-(0 rows)
-
-\c :provider_dsn
--- cleanup
-\c :provider_dsn
-SELECT * FROM spock.repset_remove_table('default', 'users');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_remove_table('default', 'basic_conflict');
- repset_remove_table 
----------------------
- t
-(1 row)
-
-SELECT spock.replicate_ddl($$
-    DROP TABLE users CASCADE;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT spock.replicate_ddl($$
-	DROP TABLE basic_conflict;
-$$);
- replicate_ddl 
----------------
- t
-(1 row)
-
-ALTER SYSTEM SET spock.save_resolutions = off;
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/autoddl.out /Users/pgedge/pgedge/spock-ibrar/results/autoddl.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/autoddl.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/autoddl.out	2025-12-04 16:02:53
@@ -1,85 +1,8 @@
 --Tuple Origin
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 -- This is to ensure that the test runs with the correct configuration
 \c :provider_dsn
-ALTER SYSTEM SET spock.enable_ddl_replication = 'on';
-ALTER SYSTEM SET spock.include_ddl_repset = 'on';
-ALTER SYSTEM SET spock.allow_ddl_from_functions = 'on';
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
-\c :provider_dsn
--- Create schema with tables on provider (node 1)
-CREATE SCHEMA hollywood
-    CREATE TABLE films (title text, release date, awards text[])
-    CREATE TABLE shorts (title text, release date, awards text[]);
-INFO:  DDL statement replicated.
--- Create a test table on provider (node 1)
-CREATE TABLE test1 (id int primary key, name text);
-INFO:  DDL statement replicated.
--- Create a function that creates two tables when called on provider (node 1)
-CREATE FUNCTION auto_ddl_test() RETURNS void AS $func$
-BEGIN
-    EXECUTE 'CREATE TABLE test2 (id int primary key, name text)';
-    EXECUTE 'CREATE TABLE test3 (id int primary key, name text)';
-END;
-$func$ LANGUAGE plpgsql;
-INFO:  DDL statement replicated.
--- Call function to create tables test2 and test3
-SELECT auto_ddl_test();
-INFO:  DDL statement replicated.
-INFO:  DDL statement replicated.
- auto_ddl_test 
----------------
- 
-(1 row)
-
-INSERT INTO test1 VALUES (1, 'one'), (2, 'two');
--- Generate a sync event
-SELECT spock.sync_event() as sync_event
-\gset
-\c :subscriber_dsn
--- Wait for sync event to be processed on subscriber (node 2)
-CALL spock.wait_for_sync_event(true, 'test_provider', :'sync_event');
- result 
---------
- t
-(1 row)
-
--- Check schema, table and function appear on subscriber (node 2)
-SELECT count(*) FROM spock.tables where nspname = 'hollywood' AND set_name IS NOT NULL;
- count 
--------
-     2
-(1 row)
-
-SELECT count(*) FROM spock.tables where relname = 'test1' AND set_name IS NOT NULL;
- count 
--------
-     1
-(1 row)
-
-SELECT count(*) FROM spock.tables where (relname = 'test2' or relname = 'test3') AND set_name IS NOT NULL;
- count 
--------
-     2
-(1 row)
-
--- Reset the configuration to the default value
-\c :provider_dsn
-ALTER SYSTEM SET spock.enable_ddl_replication = 'off';
-WARNING:  This DDL statement will not be replicated.
-ALTER SYSTEM SET spock.include_ddl_repset = 'off';
-WARNING:  This DDL statement will not be replicated.
-ALTER SYSTEM SET spock.allow_ddl_from_functions = 'off';
-WARNING:  This DDL statement will not be replicated.
-SELECT pg_reload_conf();
- pg_reload_conf 
-----------------
- t
-(1 row)
-
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/sync_table.out /Users/pgedge/pgedge/spock-ibrar/results/sync_table.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/sync_table.out	2025-11-13 18:00:30
+++ /Users/pgedge/pgedge/spock-ibrar/results/sync_table.out	2025-12-04 16:02:53
@@ -1,206 +1,10 @@
 /* First test whether a table's replication set can be properly manipulated */
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 --
 -- Test resynchronization
 --
 \c :provider_dsn
-SELECT spock.replicate_ddl('CREATE TABLE test_sync(x integer primary key)');
- replicate_ddl 
----------------
- t
-(1 row)
-
-SELECT * FROM spock.repset_add_table('default', 'test_sync');
- repset_add_table 
-------------------
- t
-(1 row)
-
-INSERT INTO test_sync (x) SELECT value FROM generate_series(1,10) AS value;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-  55 |    10
-(1 row)
-
-\c :subscriber_dsn
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-  55 |    10
-(1 row)
-
-SELECT sync_kind,sync_nspname,sync_relname,sync_status, sync_statuslsn <> '0/0'
-FROM spock.local_sync_status;
- sync_kind | sync_nspname | sync_relname | sync_status | ?column? 
------------+--------------+--------------+-------------+----------
- f         |              |              | r           | f
-(1 row)
-
-SELECT spock.sub_resync_table('test_subscription', 'test_sync', true);
- sub_resync_table 
-------------------
- t
-(1 row)
-
-SELECT spock.table_wait_for_sync('test_subscription', 'test_sync');
- table_wait_for_sync 
----------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-  55 |    10
-(1 row)
-
-SELECT sync_kind,sync_nspname,sync_relname,sync_status, sync_statuslsn <> '0/0'
-FROM spock.local_sync_status;
- sync_kind | sync_nspname | sync_relname | sync_status | ?column? 
------------+--------------+--------------+-------------+----------
- f         |              |              | r           | f
- d         | public       | test_sync    | r           | t
-(2 rows)
-
-SELECT spock.sub_resync_table('test_subscription', 'test_sync', true);
- sub_resync_table 
-------------------
- t
-(1 row)
-
-SELECT spock.table_wait_for_sync('test_subscription', 'test_sync');
- table_wait_for_sync 
----------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-  55 |    10
-(1 row)
-
-SELECT sync_kind,sync_nspname,sync_relname,sync_status, sync_statuslsn <> '0/0'
-FROM spock.local_sync_status;
- sync_kind | sync_nspname | sync_relname | sync_status | ?column? 
------------+--------------+--------------+-------------+----------
- f         |              |              | r           | f
- d         | public       | test_sync    | r           | t
-(2 rows)
-
-\c :provider_dsn
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-  55 |    10
-(1 row)
-
--- Add more values and check they were added
-INSERT INTO test_sync (x) SELECT -value FROM generate_series(1,10) AS value;
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-   0 |    20
-(1 row)
-
-\c :subscriber_dsn
--- Restart syncing this specific table, wait until the process finish and check
--- all the data stay consistent
-SELECT sync_kind,sync_nspname,sync_relname,sync_status, sync_statuslsn <> '0/0'
-FROM spock.local_sync_status;
- sync_kind | sync_nspname | sync_relname | sync_status | ?column? 
------------+--------------+--------------+-------------+----------
- f         |              |              | r           | f
- d         | public       | test_sync    | r           | t
-(2 rows)
-
-SELECT spock.sub_resync_table('test_subscription', 'test_sync', true);
- sub_resync_table 
-------------------
- t
-(1 row)
-
-SELECT spock.table_wait_for_sync('test_subscription', 'test_sync');
- table_wait_for_sync 
----------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-   0 |    20
-(1 row)
-
-SELECT sync_kind,sync_nspname,sync_relname,sync_status, sync_statuslsn <> '0/0'
-FROM spock.local_sync_status;
- sync_kind | sync_nspname | sync_relname | sync_status | ?column? 
------------+--------------+--------------+-------------+----------
- f         |              |              | r           | f
- d         | public       | test_sync    | r           | t
-(2 rows)
-
--- Check all data still in place
-\c :provider_dsn
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-   0 |    20
-(1 row)
-
--- Test that a TRUNCATE command also re-syncing correctly
-TRUNCATE test_sync;
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL);
- wait_slot_confirm_lsn 
------------------------
- 
-(1 row)
-
-\c :subscriber_dsn
-SELECT spock.sub_resync_table('test_subscription', 'test_sync', true);
- sub_resync_table 
-------------------
- t
-(1 row)
-
-SELECT spock.table_wait_for_sync('test_subscription', 'test_sync');
- table_wait_for_sync 
----------------------
- 
-(1 row)
-
-SELECT sum(x), count(*) FROM test_sync;
- sum | count 
------+-------
-     |     0
-(1 row)
-
-\c :provider_dsn
--- Cleanup
-SELECT spock.repset_remove_table('default', 'test_sync', true);
- repset_remove_table 
----------------------
- t
-(1 row)
-
-DROP TABLE test_sync;
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
diff -U3 /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/drop.out /Users/pgedge/pgedge/spock-ibrar/results/drop.out
--- /Users/pgedge/pgedge/spock-ibrar/tests/regress/expected/drop.out	2025-11-20 18:20:49
+++ /Users/pgedge/pgedge/spock-ibrar/results/drop.out	2025-12-04 16:02:53
@@ -1,67 +1,6 @@
 SELECT * FROM spock_regress_variables()
 \gset
+ERROR:  unrecognized configuration parameter "spock.orig_provider_dsn"
+CONTEXT:  SQL function "spock_regress_variables" statement 1
 \c :provider_dsn
-SELECT * FROM spock.node_drop(node_name := 'test_provider');
-ERROR:  cannot drop node "test_provider" because one or more replication slots for the node are still active
-HINT:  drop the subscriptions connected to the node first
-SELECT plugin, slot_type, active FROM pg_replication_slots;
-    plugin    | slot_type | active 
---------------+-----------+--------
- spock_output | logical   | t
-(1 row)
-
-SELECT count(*) FROM pg_stat_replication;
- count 
--------
-     1
-(1 row)
-
-\c :subscriber_dsn
-SELECT * FROM spock.sub_drop('test_subscription');
- sub_drop 
-----------
-        1
-(1 row)
-
-SELECT * FROM spock.node_drop(node_name := 'test_subscriber');
- node_drop 
------------
- t
-(1 row)
-
-\c :provider_dsn
--- Check corner-case of wait function when no replication slots exist.
-SELECT slot_name FROM pg_replication_slots; -- must be empty
- slot_name 
------------
-(0 rows)
-
-SET statement_timeout = '100ms';
-SELECT spock.wait_slot_confirm_lsn(NULL, NULL); -- trigger the statement_timeout ERROR
-ERROR:  canceling statement due to statement timeout
-SELECT * FROM spock.node_drop(node_name := 'test_provider');
- node_drop 
------------
- t
-(1 row)
-
-\c :subscriber_dsn
-DROP OWNED BY nonsuper, super CASCADE;
-\c :provider_dsn
-DROP OWNED BY nonsuper, super CASCADE;
-\c :provider1_dsn
-DROP OWNED BY nonsuper, super CASCADE;
-\c :orig_provider_dsn
-DROP OWNED BY nonsuper, super CASCADE;
-\c :subscriber_dsn
-SET client_min_messages = 'warning';
-DROP ROLE IF EXISTS nonsuper, super;
-\c :provider_dsn
-SET client_min_messages = 'warning';
-DROP ROLE IF EXISTS nonsuper, super;
-\c :provider1_dsn
-SET client_min_messages = 'warning';
-DROP ROLE IF EXISTS nonsuper, super;
-\c :orig_provider_dsn
-SET client_min_messages = 'warning';
-DROP ROLE IF EXISTS nonsuper, super;
+\connect: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  database ":provider_dsn" does not exist
